(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"33Kz":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return o}));a("mlET"),a("Ysgh"),a("kYxP");var i=a("wrlS");const n=()=>i.a.getArrayValue("dm_reactions_config_active_reactions"),s=()=>{const e=i.a.getArrayValue("dm_reactions_config_inactive_reactions");return[...n(),...e]},r=e=>{const t=s().find(t=>t.endsWith(e));if(t)return t.split(":")[0]},o=(e={includeInactive:!1})=>e.includeInactive?s().map(e=>e.split(":")[1]):n().map(e=>e.split(":")[1])},"5Ixf":function(e,t,a){"use strict";a("IAdD");var i=a("ERkP"),n=a("Lsrn"),s=a("k/Ka");const r=(e={})=>Object(s.a)("svg",Object.assign({},e,{style:[n.a.root,e.style],viewBox:"0 0 24 24"}),i.createElement("g",null,i.createElement("path",{d:"M10 20.5c0 .828-.672 1.5-1.5 1.5h-2c-.828 0-1.5-.672-1.5-1.5v-17C5 2.672 5.672 2 6.5 2h2c.828 0 1.5.672 1.5 1.5v17zm9 0c0 .828-.672 1.5-1.5 1.5h-2c-.828 0-1.5-.672-1.5-1.5v-17c0-.828.672-1.5 1.5-1.5h2c.828 0 1.5.672 1.5 1.5v17z"})));r.metadata={width:24,height:24},t.a=r},"883S":function(e,t,a){"use strict";a.d(t,"a",(function(){return _})),a.d(t,"b",(function(){return y}));var i=a("k49u"),n=a("3XMw"),s=a.n(n),r=a("fs1G");const o=s.a.c3752568,c=s.a.f9690dc0,l=s.a.i859a9d3,d=s.a.b1d35407,p=s.a.g539cca6,u=s.a.bbac0019,h=s.a.a1d2a68d,m=s.a.d4f2d9d8,g=s.a.hf383be4,f=s.a.b25c5b2a,v=s.a.c4fdbd16,b=s.a.hf3e7e38,_={[i.a.DirectMessageConversationNotFound]:{customAction:()=>!1}},y={defaultToast:{text:o},[i.a.CurrentUserSuspended]:{toast:{text:p,actionLabel:l,actionLink:"https://support.twitter.com/articles/15790"}},[i.a.DirectMessageCannotDmOtherUser]:{toast:{text:c}},[i.a.DirectMessageDuplicate]:{toast:{text:f}},[i.a.DirectMessageOtherUserNotFollowing]:{toast:{text:h,actionLabel:l,actionLink:"https://support.twitter.com/articles/14606"}},[i.a.DirectMessagesSenderBlocksRecipient]:{toast:{text:v}},[i.a.DirectMessageTooLongError]:{toast:{text:u}},[i.a.DirectMessageTweetNotFound]:{toast:{text:m}},[i.a.GenericBadRequest]:{customAction:r.a},[i.a.MessageSendError]:{toast:{text:b}},[i.a.OverStatusUpdateLimit]:{toast:{actionLabel:l,actionLink:"https://support.twitter.com/articles/15364",text:d}},[i.a.TargetUserNotFound]:{toast:{text:g}},showToast:!0}},AQOc:function(e,t,a){"use strict";a.d(t,"b",(function(){return p})),a.d(t,"a",(function(){return u}));a("IAdD"),a("kYxP");var i=a("LdEA"),n=a.n(i),s=a("lnti"),r=a("aWyx");const o={entries:{},entryIdsByConversationId:{},reactionsByMessageId:{}},c=(e=[],t={})=>e.map(e=>{if(e.proof_type===r.d.MUTUAL_FRIENDS){const{users:a}=e,i=n()(e,["users"]);return Object.assign({},i,{users:Object(s.a)(a.map(e=>t[e]))})}return e}),l=(e=[],t={})=>e.reduce((e,a)=>{const i=a.user_id,n=t[i]||{id_str:i};return e[i]=Object.assign({},a,{user:n}),e},{}),d=(e,{entries:t,entryIdsByConversationId:a})=>(a[e]||[]).map(e=>t[e]&&t[e].data).filter(Boolean),p=(e,t=o,a)=>{const{conversation_id:i,participants:s}=e,r=n()(e,["conversation_id","participants"]);return Object.assign({conversation_id:i},r,{entries:t.entryIdsByConversationId[i]||[],participants:l(s,a)})},u=(e,t,a)=>{const{conversation_id:i,participants:s,social_proof:r}=e,o=n()(e,["conversation_id","participants","social_proof"]);return Object.assign({conversation_id:i},o,{entries:d(i,t),participants:l(s,a)},r?{social_proof:c(r,a)}:{})}},FtFR:function(e,t,a){var i=a("1Mu/"),n=a("q9+l"),s=a("q/0V"),r=a("L2rT").UNSUPPORTED_Y;i&&("g"!=/./g.flags||r)&&n.f(RegExp.prototype,"flags",{configurable:!0,get:s})},GSsg:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a("B5iK");class n{constructor(e,t=Object.freeze({})){const{interval:a=6e4,burstInterval:n=3e3,burstDuration:s=3e5}=t;this.pollTimer=new i.b(a).interval(e),this.burstTimer=new i.a(this.pollTimer,n,s)}start(e){return this.pollTimer.start(),e&&this.burstTimer.requestBurst(),this}stop(){return this.burstTimer.stopBurst(),this.pollTimer.stop(),this}restart(){return this.stop(),this.start(),this}}},H4nC:function(e,t,a){"use strict";var i=a("ERkP"),n=a("3XMw"),s=a.n(n),r=a("MWbm"),o=a("rHpw"),c=a("t62R");const l=o.a.create(e=>({root:{paddingBottom:e.spaces.medium}})),d=s.a.d84b485d,p=s.a.be0c83d7;t.a=({entry:e,isCompact:t})=>{const a="follow"===e.reason?d:p;return t?i.createElement(c.c,{color:"deepGray"},a):i.createElement(r.a,{style:l.root},i.createElement(c.c,{align:"center",color:"deepGray",size:"small"},a))}},"I2k/":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a("k49u"),n=a("lRnM"),s=a("LVU8");const r=e=>({[i.a.ClientNotPermitted]:{customAction:()=>(Object(s.d)("/messages",{statusCode:401}),Object(n.s)(e))}})},J2UM:function(e,t,a){"use strict";var i=a("0JOx");t.a=()=>Object(i.h)().then(({inputDetect:e})=>e)},MMRb:function(e,t,a){"use strict";a.r(t);var i=a("9OUN"),n=a("lRnM"),s=a("uKEd"),r=a("AQ79");a.d(t,"GLOBAL_STATE_KEY",(function(){return r.a}));var o=a("xPna"),c=a("Ssj5"),l=a("xCUF"),d=a("aWyx");a.d(t,"CONVERSATION_TYPE",(function(){return d.a})),a.d(t,"ENTRY_TYPE",(function(){return d.b})),a.d(t,"PAGINATION_STATUS",(function(){return d.c})),a.d(t,"addParticipants",(function(){return n.d})),a.d(t,"selectConversation",(function(){return n.t})),a.d(t,"selectConversationAvatarMediaId",(function(){return n.u})),a.d(t,"selectConversationFetchStatus",(function(){return n.x})),a.d(t,"selectConversationIsLoaded",(function(){return n.y})),a.d(t,"selectConversationIsRead",(function(){return n.z})),a.d(t,"selectConversationAvatarMediaIsUploading",(function(){return n.v})),a.d(t,"selectConversationAvatarMediaUploadProgress",(function(){return n.w})),a.d(t,"selectConversations",(function(){return n.B})),a.d(t,"selectEntries",(function(){return s.l})),a.d(t,"selectEntriesForConversation",(function(){return s.m})),a.d(t,"selectEntry",(function(){return s.n})),a.d(t,"selectInbox",(function(){return o.p})),a.d(t,"selectFetchStatus",(function(){return o.o})),a.d(t,"selectInboxIsLoaded",(function(){return o.q})),a.d(t,"selectIsLoadingTop",(function(){return o.r})),a.d(t,"selectUnreadCount",(function(){return o.t})),a.d(t,"selectUntrustedCursor",(function(){return o.v})),a.d(t,"selectUntrustedUnreadCount",(function(){return o.y})),a.d(t,"selectUntrustedConversationCount",(function(){return o.u})),a.d(t,"selectUntrustedLowQualityCursor",(function(){return o.x})),a.d(t,"selectUntrustedLowQualityConversationCount",(function(){return o.w})),a.d(t,"selectPoppedOutConversationId",(function(){return o.s})),a.d(t,"selectDrawerVisibility",(function(){return o.n})),a.d(t,"selectDrawerExperimentEnabled",(function(){return o.m})),a.d(t,"selectUpdates",(function(){return l.e})),a.d(t,"acceptConversation",(function(){return n.a})),a.d(t,"addAvatarMedia",(function(){return n.b})),a.d(t,"addWelcomeMessageToConversation",(function(){return n.e})),a.d(t,"disableMentionNotifications",(function(){return n.g})),a.d(t,"disableNotifications",(function(){return n.h})),a.d(t,"enableMentionNotifications",(function(){return n.i})),a.d(t,"enableNotifications",(function(){return n.j})),a.d(t,"fetchConversation",(function(){return n.k})),a.d(t,"fetchConversationFromParticipants",(function(){return n.l})),a.d(t,"fetchConversationIfNeeded",(function(){return n.n})),a.d(t,"fetchConversationHistory",(function(){return n.m})),a.d(t,"leaveConversation",(function(){return n.o})),a.d(t,"markAllAsRead",(function(){return n.p})),a.d(t,"markConversationRead",(function(){return n.q})),a.d(t,"removeAvatarMedia",(function(){return n.r})),a.d(t,"removeConversation",(function(){return n.s})),a.d(t,"setConversationAvatar",(function(){return n.C})),a.d(t,"toggleNotifications",(function(){return n.D})),a.d(t,"updateConversationReadState",(function(){return n.I})),a.d(t,"updateConversationAvatar",(function(){return n.E})),a.d(t,"updateConversationName",(function(){return n.G})),a.d(t,"updateTyping",(function(){return n.J})),a.d(t,"fetchInbox",(function(){return o.d})),a.d(t,"fetchInboxIfNeeded",(function(){return o.e})),a.d(t,"fetchTrustedInboxHistory",(function(){return o.f})),a.d(t,"fetchUntrustedInboxHistory",(function(){return o.g})),a.d(t,"fetchUntrustedLowQualityInboxHistory",(function(){return o.h})),a.d(t,"updateLastSeenEventId",(function(){return o.B})),a.d(t,"updateTrustedLastSeenEventId",(function(){return o.C})),a.d(t,"updateUntrustedLastSeenEventId",(function(){return o.D})),a.d(t,"popOutConversation",(function(){return o.l})),a.d(t,"setDrawerVisibility",(function(){return o.A})),a.d(t,"loadDrawerVisibilityFromPersistence",(function(){return o.k})),a.d(t,"setDrawerExperimentEnabled",(function(){return o.z})),a.d(t,"loadDrawerExperimentFromPersistence",(function(){return o.j})),a.d(t,"deleteEntry",(function(){return s.f})),a.d(t,"markSpamStatus",(function(){return s.h})),a.d(t,"removeEntry",(function(){return s.j})),a.d(t,"fetchUpdates",(function(){return l.b})),a.d(t,"fetchUpdatesIfNeeded",(function(){return l.d}));const p=Object(i.c)({conversations:n.f,entries:s.e,inbox:o.c,updates:l.a});c.a.register({[r.a]:p}),t.default=p},OhSZ:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));a("kYxP");var i=a("ERkP"),n=a("aWyx"),s=a("XnpN"),r=a("jV+4"),o=a("t62R"),c=a("p9G8");const l=(e=[])=>e.map(({data:e})=>e),d=({conversation:e,newConversationParticipants:t,perspective:a})=>{if(e){if(e.type===n.a.ONE_TO_ONE){const[t]=Object(s.a)(e,a).map(({user:e})=>e);return t.name}return Object(c.a)(e,a)}{const e=l(t);return Object(c.b)(e,a)}};t.b=({conversation:e,newConversationParticipants:t,perspective:a,titleWeight:d="bold",textColor:p="normal",withScreenName:u=!0})=>{if(e){if(e.type===n.a.ONE_TO_ONE){const[t]=Object(s.a)(e,a).map(({user:e})=>e);return i.createElement(r.a,{color:p,isProtected:t.protected,isVerified:t.verified,name:t.name,screenName:t.screen_name,weight:d,withLink:!1,withScreenName:u})}return i.createElement(o.c,{color:p,numberOfLines:1,weight:d},Object(c.a)(e,a))}{const e=l(t);return i.createElement(o.c,{color:p,numberOfLines:1,weight:d},Object(c.b)(e,a))}}},Oi4X:function(e,t,a){"use strict";a("IAdD"),a("JtPf"),a("Qavd"),a("MvUL"),a("kYxP");var i=a("KEM+"),n=a.n(i),s=a("ERkP"),r=a("0JOx"),o=a("zh9S"),c=a("MMRb"),l=a("VnFT"),d=a("RqPI"),p=a("1YZw"),u=a("oEGd"),h=a("0KEI"),m=a("hqKg"),g=a("kGix"),f=a("Myq3"),v=a("AQOc"),b=a("UhuB"),_=a("pNZL"),y=a("G6rE"),E=a("P1r1"),C=a("X/yg");const S=(e,t)=>t.conversationId,x=Object(m.createSelector)(c.selectFetchStatus,(e,t)=>c.selectConversationFetchStatus(e,S(0,t)),(e,t)=>e===g.a.LOADED?t:e),R=Object(m.createSelector)((e,t)=>c.selectEntriesForConversation(e,S(0,t)),d.g,(e,t)=>t?((e,t)=>{const a=Object(f.a)(e,e=>!!e.message_data&&(e.message_data&&e.message_data.recipient_id===t));return a&&a.message_data&&a.message_data.quick_reply&&a.message_data.quick_reply&&"options"===a.message_data.quick_reply.type?a.message_data.quick_reply:void 0})(e,t):void 0),A=Object(m.createSelector)((e,t)=>c.selectConversation(e,S(0,t)),c.selectEntries,C.d,d.g,C.e,C.f,y.e.selectAll,x,(e,t)=>c.selectConversationIsLoaded(e,S(0,t)),(e,t)=>l.g(e,S(0,t)),(e,t)=>l.j(e,S(0,t)),(e,t)=>l.i(e,S(0,t)),(e,t)=>l.k(e,S(0,t)),(e,t)=>l.l(e,S(0,t)),(e,t)=>l.h(e,S(0,t)),(e,t)=>l.m(e,S(0,t)),E.j,b.j,R,E.l,(e,t,a,i,n,s,r,o,c,l,d,p,u,h,m,g,f,b,_,y)=>{const E=e&&e.data;return{conversation:E&&Object(v.a)(E,t,r),dataSaverMode:f,draftText:g,dtabBarInfo:y,fetchStatus:o,gifMetadata:m,isDmReceiptSettingEnabled:b,isLoaded:c,cardUrl:l,isNewGroupConversation:a,isUploading:d,media:p,mediaMetadata:u,mediaUploadProgress:h,newConversationParticipants:n,perspective:i,quickReplyOptions:_,tweetAttachment:s}}),I=e=>()=>l.b(e),w=e=>t=>l.c(e,t);var O=Object(u.d)(A,e=>{return{acceptConversation:c.acceptConversation,addMedia:(t=e.conversationId,(e,a)=>l.a(t,e,a)),saveText:l.f,addToast:p.b,addWelcomeMessageToConversation:c.addWelcomeMessageToConversation,cancelUpload:I(e.conversationId),createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationHistory:c.fetchConversationHistory,fetchConversationIfNeeded:c.fetchConversationIfNeeded,fetchInboxIfNeeded:c.fetchInboxIfNeeded,fetchUpdatesIfNeeded:c.fetchUpdatesIfNeeded,googleAnalyticsPageView:o.a,leaveConversation:c.leaveConversation,removeMedia:w(e.conversationId),removeText:l.d,scribeAction:o.c,scribePageImpression:o.d,sendMessage:l.n,updateConversationReadState:c.updateConversationReadState,updateTweetDetailNav:_.b,updateTyping:c.updateTyping,removeConversation:c.removeConversation,popOutConversation:c.popOutConversation};var t}),T=a("7JQg"),k=a("I2k/"),M=a("n+Zb"),L=(a("6/0d"),a("IRWI")),F=a("VPAj");const D=(e,t)=>e.getForItem(t).doesIntersectWith(e.getForViewport()),j=e=>e.getForList().getBottom()-e.getForViewport().getBottom();var P=({isOwnMessage:e,typingIndicatorId:t})=>{const a=e=>Object(f.a)(e.getList(),e=>e.id!==t);return Object.assign({},L.a,{initialScrollHeadroom:Object(F.a)(0),scrollHeadroom:Object(F.a)(0),offsetCorrection:(i,n)=>{const s=a(i),r=a(n),o=r&&(!s||s.id!==r.id),c=r&&e(r.data.data),l=s&&D(i,s.id);return o&&(c||l)||l&&((e,a)=>{const i=e.getForItem(t),n=a.getForItem(t);return!i||n&&n.getHeight()>i.getHeight()})(i,n)?Math.max(0,j(n)):L.a.offsetCorrection(i,n)}})},B=a("aWyx");const N=(e,t)=>({entry:{id:t,time:"",type:e},isActive:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,type:e}),U=N(B.b.CONVERSATION_PROFILE_INFO_HEADER,"conversationProfileInfoHeader"),W=N(B.b.TYPING_INDICATOR,"typingIndicator"),H=N(B.b.READ_ONLY_INDICATOR,"readOnlyIndicator");var z=a("b9JY");var G=(e,t)=>{if(e&&e.message_data&&t&&t.message_data&&Object(z.b)(e)&&Object(z.b)(t)){const{sender_id:a,time:i}=e.message_data,{sender_id:n,time:s}=t.message_data,r=parseInt(s,10)-parseInt(i,10);return a===n&&r>=0&&r<=6e4}return!1},V=a("jat/"),q=(a("jQ/y"),a("v6aA")),Y=a("XnpN"),K=a("LhSm"),Q=a("I4+6"),$=a("rHpw"),J=a("cm6r"),X=a("SEra"),Z=a("jV+4"),ee=a("pBrB"),te=a("wCd/");const ae=(e,t)=>{const a=Object(Y.a)(e,t).map(({user:e})=>e),i=a&&a[0];return{userDescription:i&&i.description,userEntities:i&&i.entities,userFollowerCount:i&&i.followers_count,userFriendsCount:i&&i.friends_count,userIdStr:i&&i.id_str,userJoinDate:i&&i.created_at,userName:i&&i.name,userScreenName:i&&i.screen_name,userIsVerified:i&&i.verified}},ie=$.a.create(e=>({root:{flexDirection:"column",alignItems:"center",marginBottom:e.spaces.small,paddingVertical:e.spaces.medium,paddingHorizontal:e.spaces.small,borderRadius:e.borderRadii.small},profileInfoItemMargin:{marginBottom:e.spaces.xxSmall},borderBottom:{borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid"}}));var ne=({conversation:e,withBottomBorder:t=!0})=>{const{loggedInUserId:a}=s.useContext(q.a);if(!e)return null;const{userDescription:i,userEntities:n,userFollowerCount:r,userFriendsCount:o,userIdStr:c,userJoinDate:l,userName:d,userScreenName:p,userIsVerified:u}=ae(e,a||""),h=!!(d&&p&&(r&&o||l)),m=Q.a.generate({color:$.a.theme.colors.text,backgroundColor:$.a.theme.colors.transparent,customFocusBackgroundColor:$.a.theme.colors.faintGray,customHoverBackgroundColor:$.a.theme.colors.faintGray,customPressedBackgroundColor:$.a.theme.colors.activeFaintGray});return s.createElement(J.a,{interactiveStyles:m,link:X.a.withAnchorless("https://twitter.com/"+(p||"")),style:[ie.root,t&&h&&ie.borderBottom]},s.createElement(Z.a,{isVerified:u,name:d,screenName:p,style:ie.profileInfoItemMargin,weight:"bold",withHoverCard:!0,withLink:!0}),i&&n&&c?s.createElement(ee.a,{description:i,entities:n,style:ie.profileInfoItemMargin,userId:c}):null,r&&o?s.createElement(te.a,{followersCount:r,friendsCount:o,screenName:p||"",style:ie.profileInfoItemMargin,withLink:!1}):null,l?s.createElement(K.a,{joinDate:l}):null)},se=a("g54k"),re=a("aA19"),oe=a("mN6z"),ce=(a("AxOO"),a("MWbm")),le=a("t62R"),de=a("oSwX"),pe=a("MAI/"),ue=a("zQEV");a("aWzz");const he=({children:e,link:t,style:a})=>s.createElement(le.c,{align:"center",color:"deepGray",link:t,size:"small",style:a},e);class me extends s.Component{constructor(...e){super(...e),n()(this,"_renderContents",()=>{const{conversation:e,entry:t,entryType:a,perspective:i,users:n}=this.props,r=Object(ue.a)(t,a,i,n);switch(a){case B.b.CONVERSATION_AVATAR_UPDATE:return s.createElement(s.Fragment,null,this._isValidImageSource(t.conversation_avatar_image_https)?s.createElement(ce.a,{style:ge.conversationAvatarContainer},s.createElement(re.a,{conversation:e,perspective:i})):null,s.createElement(he,null,r));case B.b.JOIN_CONVERSATION:{const e=this._getAddedYouMessageWithProfileInfo(r),t=this._getParticipantsFromEntry(),a=s.createElement(le.c,{align:"center",color:"deepGray",size:"small"},this._getParticipantsFromEntryText(t)),i=this._getJoinConversationDetailsWithFacepile(t,a);return s.createElement(s.Fragment,null,e,i)}default:return s.createElement(he,null,r)}}),n()(this,"_getAddedYouMessageWithProfileInfo",e=>{const{entry:t,users:a}=this.props,i=t.sender_id?a[t.sender_id]:void 0,n=i?{pathname:"https://twitter.com/"+i.screen_name}:void 0;return s.createElement(J.a,{interactiveStyles:null,link:n,style:ge.userAddedYouContainer},i?s.createElement(de.default,{accessibilityLabel:i.screen_name,screenName:i.screen_name,size:"medium",uri:i.profile_image_url_https,withHoverCard:!0,withLink:!0}):null,s.createElement(he,{link:n,style:ge.userAddedYouText},e))}),n()(this,"_getJoinConversationDetailsWithFacepile",(e,t)=>{const{conversation:a}=this.props,i=e.slice(0,20).map(({profile_image_url_https:e})=>e);return s.createElement(J.a,{interactiveStyles:null,link:{pathname:`/messages/${a.conversation_id}/participants`},style:ge.joinConversationDetails},t,s.createElement(pe.a,{style:ge.userAvatarFacepile,userAvatarSize:"xLarge",userAvatarUrls:i}))})}shouldComponentUpdate(e){return!Object(oe.a)(this.props,e)}render(){return s.createElement(ce.a,{style:ge.root},this._renderContents())}_isValidImageSource(e){return e&&""!==e&&e.indexOf("MEDIA_NOT_FOUND")<0}_getParticipantsFromEntry(){const{entry:e,perspective:t,users:a}=this.props;return e.participants?e.participants.filter(({user_id:e})=>t!==e).map(({user_id:e})=>a[e]).filter(Boolean):[]}_getParticipantsFromEntryText(e){const{conversation:{conversation_id:t}}=this.props;return Object(ue.b)(e.length,t)}}const ge=$.a.create(e=>({root:{paddingBottom:e.spaces.medium},conversationAvatarContainer:{alignSelf:"center",height:e.spaces.jumbo,marginBottom:e.spaces.xSmall,width:e.spaces.jumbo},userAddedYouContainer:{flexDirection:"row",justifyContent:"center"},userAddedYouText:{flexShrink:1,marginLeft:e.spaces.xSmall},joinConversationDetails:{marginTop:e.spaces.xxSmall},userAvatarList:{marginTop:e.spaces.xxSmall},userAvatarFacepile:{marginTop:e.spaces.xxSmall,justifyContent:"center"}}));var fe=Object(se.a)(me);const ve={scribeAction:o.c},be=Object(m.createSelector)((e,t)=>y.e.select(e,t.senderId),E.k,(e,t)=>({user:e,displaySensitiveMedia:t}));var _e=Object(u.g)(be,ve);const ye={addToast:p.b,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_OVERFLOW_ACTIONS"),deleteEntry:c.deleteEntry};var Ee=Object(u.b)(ye),Ce=a("k49u"),Se=a("LVU8"),xe=a("3XMw"),Re=a.n(xe);const Ae=Re.a.f58dff33,Ie=Re.a.ad5a8e8e,we={[Ce.a.MissingParameter]:{toast:Object(Se.a)(Ae)},[Ce.a.DirectMessageDestroyPermissionsError]:{toast:{text:Ie}},showToast:!0};a("x4t0");var Oe=a("xCUF"),Te=a("uKEd");const ke=[],Me=Object(m.createSelector)(e=>Object(Te.l)(e).entries,(e,t)=>Object(Te.p)(e,t.entry.id)||ke,(e,t)=>t.perspective,(e,t,a)=>({selectedReactions:t.filter(t=>{const i=e[t]&&e[t].data;return i&&i.sender_id===a}).map(t=>e[t].data.reaction_key)})),Le={createReaction:Te.d,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_REACTIONS_POPOVER"),fetchUpdatesIfNeeded:Oe.d,removeReaction:Te.k};var Fe=Object(u.g)(Me,Le),De=a("33Kz"),je=a("wTX1");var Pe=({accessible:e,accessibilityLabelFormatter:t,count:a,emojiSize:i,emotion:n,enableHoverStyle:r,onPress:o,style:c})=>{const l=Object(De.b)(n),d=t&&l?t({emoji:l,count:a}):void 0,p=Q.a.generate({backgroundColor:$.a.theme.colors.fadedGray,color:$.a.theme.colors.deepGray});return s.createElement(J.a,{accessibilityLabel:d,accessible:e,interactiveStyles:r?p:null,onPress:o,style:[Be.container,...c||[]]},s.createElement(le.c,{size:i,style:Be.unsetLineHeight},l),a&&s.createElement(je.a,{color:"deepGray",containerStyle:Be.count,count:a,size:"xSmall"},a))};const Be=$.a.create(e=>({container:{flexDirection:"row"},count:{alignSelf:"center",minWidth:e.spaces.small,paddingLeft:e.spaces.micro},unsetLineHeight:{lineHeight:"unset"}}));var Ne=a("Irs7");const Ue=Re.a.ca7a2214,We=Re.a.fc0e94b7;class He extends s.Component{constructor(...e){super(...e),n()(this,"_handleReactionScribing",(e,t)=>{const{analytics:a}=this.props,i=t?"delete_reaction":"create_reaction";a.scribe({section:"twitter_service",component:"direct_messages",element:i,action:"success",data:{reaction_emotion:e}})}),n()(this,"_reactionClickHandler",(e,t)=>()=>{const{createReaction:a,createLocalApiErrorHandler:i,dismiss:n,fetchUpdatesIfNeeded:s,removeReaction:r,entry:o,perspective:c}=this.props,l={reaction_key:e,conversation_id:o.conversation_id,dm_id:o.id,perspective:c};(t?r:a)(l).then(this._handleReactionScribing(e,t)).then(()=>s()).catch(i()),n()})}render(){const{selectedReactions:e}=this.props,t=Object(De.a)().map(t=>{const a=e.includes(t);return s.createElement(Pe,{accessibilityLabelFormatter:a?Ue:We,accessible:!0,emojiSize:"xLarge",emotion:t,enableHoverStyle:!0,key:t,onPress:this._reactionClickHandler(t,a),style:[Ge.reaction,a&&Ge.selectedReaction]})});return s.createElement(ce.a,{style:Ge.reactions},t)}}var ze=Object(Ne.a)(Fe(He));const Ge=$.a.create(e=>({reactions:{cursor:"pointer",flexDirection:"row",padding:e.spaces.xSmall},reaction:{borderRadius:e.borderRadii.medium,padding:e.spaces.xxSmall},selectedReaction:{backgroundColor:e.colors.fadedGray}}));var Ve=a("OiMc");class qe extends s.Component{constructor(...e){super(...e),n()(this,"_renderDMReactionPickerContent",e=>{const{entry:t,perspective:a}=this.props;return s.createElement(ze,{dismiss:e,entry:t,perspective:a})})}render(){const{children:e,onDismiss:t}=this.props;return s.createElement(Ve.a,{enableEnterKeyToggle:!0,onDismiss:t,preferredVerticalOrientation:"up",renderContent:this._renderDMReactionPickerContent,withArrow:!0},e)}}var Ye=a("fz3c"),Ke=a("mjJ+"),Qe=a("Q0VY"),$e=a("eb3s"),Je=a("/yvb"),Xe=a("ZToW"),Ze=a("CaKu"),et=a("i4Oy"),tt=(a("tVqn"),a("4w6w"));const at=(e,t)=>{if(null==e)return!1;const[a,i]=t||[0,0];return!((0===a||1===a)&&e.length===i)},it=e=>{const{message_data:t}=e;if(!t)return!1;const{attachment:a}=t;if(!a)return!0;if(a.sticker)return!1;const i=a.tweet||a.photo||a.animated_gif||a.video||void 0;if(i)return at(t.text,i.indices);if(a.card){var n;const e=((null==(n=t.entities)?void 0:n.urls)||[]).find(e=>e.url===a.card);return at(t.text,e&&e.indices)}return!0},nt=e=>{var t;const a=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!a||!(a.card||a.tweet||a.photo||a.animated_gif||a.video||a.fleet))},st=e=>{var t;const a=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!a||!a.fleet)},rt=(e,t,a)=>{const i=1.25*parseFloat($.a.theme.fontSizes.normal);return{compositeRendered:e?void 0!==t&&void 0!==a:void 0!==t,isTextSquared:void 0!==t&&void 0!==a&&(a===t||a<=t-i),isAttachmentSquared:void 0!==a&&void 0!==t&&(t===a||t<=a-i)}};var ot=a("hiGS"),ct=a("zIWA"),lt=a("Lsrn"),dt=a("k/Ka");const pt=(e={})=>Object(dt.a)("svg",Object.assign({},e,{style:[lt.a.root,e.style],viewBox:"0 0 24 24"}),s.createElement("g",null,s.createElement("path",{d:"M16.925 9.5H14.5V7.075c0-.414-.336-.75-.75-.75s-.75.336-.75.75V9.5h-2.425c-.414 0-.75.336-.75.75s.336.75.75.75H13v2.425c0 .414.336.75.75.75s.75-.336.75-.75V11h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-.3 11H4.25c-.413 0-.75-.337-.75-.75V8.402c0-.414-.336-.75-.75-.75s-.75.336-.75.75V19.75C2 20.99 3.01 22 4.25 22h12.375c.414 0 .75-.336.75-.75s-.336-.75-.75-.75z"}),s.createElement("path",{d:"M19.75 2h-12C6.51 2 5.5 3.01 5.5 4.25v12c0 1.24 1.01 2.25 2.25 2.25h12c1.24 0 2.25-1.01 2.25-2.25v-12C22 3.01 20.99 2 19.75 2zm.75 14.25c0 .413-.337.75-.75.75h-12c-.413 0-.75-.337-.75-.75v-12c0-.413.337-.75.75-.75h12c.413 0 .75.337.75.75v12z"})));pt.metadata={width:24,height:24};var ut=pt;const ht=(e={})=>Object(dt.a)("svg",Object.assign({},e,{style:[lt.a.root,e.style],viewBox:"0 0 24 24"}),s.createElement("g",null,s.createElement("path",{d:"M22.436 16.92H19.76v-2.673c0-.415-.335-.75-.75-.75s-.75.335-.75.75v2.674h-2.676c-.413 0-.75.337-.75.75s.337.75.75.75h2.677v2.677c0 .413.337.75.75.75s.75-.337.75-.75V18.42h2.676c.414 0 .75-.337.75-.75s-.336-.75-.75-.75z"}),s.createElement("path",{d:"M11.088 21.214c-2.61-.046-10.064-6.778-10.064-13.157 0-3.066 2.525-5.755 5.404-5.755 2.29 0 3.83 1.582 4.646 2.73.816-1.148 2.357-2.73 4.646-2.73 2.878 0 5.403 2.69 5.403 5.755 0 1.13-.232 2.323-.69 3.545-.145.39-.58.584-.966.44-.388-.146-.584-.58-.438-.966.394-1.053.594-2.07.594-3.02 0-2.266-1.824-4.254-3.903-4.254-2.525 0-3.94 2.937-3.952 2.966-.23.562-1.155.562-1.387 0-.01-.03-1.425-2.966-3.952-2.966-2.08 0-3.904 1.988-3.904 4.255 0 5.76 7.076 11.63 8.563 11.657.168-.003.764-.195 1.758-.892.343-.238.81-.154 1.045.184.237.34.155.808-.184 1.045-1.085.76-1.966 1.153-2.618 1.164z"})));ht.metadata={width:24,height:24};var mt=ht,gt=a("FRoe");const ft=Re.a.ba60339a,vt=Re.a.j4bfee22,bt=Re.a.d96cf7cd,_t=Re.a.faddd3a2,yt=Re.a.eb497e08,Et=Re.a.b170974a,Ct=Re.a.i202bd22,St=Re.a.f2e5491a,xt=Re.a.f88553c8;class Rt extends s.Component{constructor(e){super(e),n()(this,"_renderOverflowMenu",e=>{const{entry:t,isSent:a,analytics:i}=this.props,n=i.contextualScribeNamespace,r=[{text:ft,Icon:ot.a,isEmphasized:!0,onClick:this._handleShowDeleteConfirmation(e)}];return a||r.push({text:Ct,Icon:ct.a,link:{pathname:`/i/report/${Ye.a.DMMessage}/${t.id}`,state:{clientReferer:window.location.pathname,conversationId:t.conversation_id,scribeNamespace:n}}}),Ze.a.isAvailable()&&r.push({text:St,Icon:ut,onClick:this._handleCopyMessageText}),s.createElement(Ke.a,{items:r,onCloseRequested:this._handleHideActionsAndMenus(e),preferredHorizontalOrientation:"right"})}),n()(this,"_handleCopyMessageText",e=>{const{addToast:t}=this.props,a=this._replaceMessageUrls();a&&(Ze.a.setString(a),t({text:xt})),e&&e()}),n()(this,"_handleSetActionsActive",()=>{const{setShouldFreezeUpdates:e}=this.props;this.setState({actionsAreActive:!0}),e(!0)}),n()(this,"_handleDelete",()=>{const{createLocalApiErrorHandler:e,deleteEntry:t,entry:a}=this.props;t({conversationId:a.conversation_id,id:a.id}).catch(e(we))}),n()(this,"_handleHideDeleteConfirmation",()=>{this.setState({showDeleteConfirmation:!1})}),n()(this,"_handleHideActionsAndMenus",e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e&&e(),this.setState({actionsAreActive:!1}),t(!1)}),n()(this,"_handlePressReactionPickerButton",()=>{const{analytics:e,entry:t}=this.props;e.scribe({component:"reaction_button",element:Object(C.a)(t),action:"click"}),this._handleSetActionsActive()}),n()(this,"_handleShowDeleteConfirmation",e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e(),this.setState({actionsAreActive:!1,showDeleteConfirmation:!0}),t(!1)}),n()(this,"_replaceMessageUrls",()=>{const{entry:e}=this.props,t=e&&e.message_data&&e.message_data.entities;let a=e&&e.message_data&&e.message_data.text||"";return Qe.a.tweetTextParts(a,[0,a.length],t).forEach(e=>{"url"===e.entityType&&(a=a.replace(e.url,e.expandedUrl))}),a}),this.state={actionsAreActive:!1,showDeleteConfirmation:!1},this._hasMedia=nt(this.props.entry),this._isNarrow=et.a.get("screen").width<$.a.theme.breakpoints.xSmall}render(){const{isSent:e,shouldShowReactionButton:t}=this.props,a=this._areActionsVisible();return s.createElement(ce.a,{pointerEvents:a?"auto":"none",style:[It.messageActions,e?It.messageActionsLeft:It.messageActionsRight,a?It.visible:It.invisible,this._isNarrow&&(this._hasMedia?It.messageActionsMediaNarrow:It.messageActionsNarrow)]},t&&this._renderReactionButton(),this._renderOverflowButton(),this._renderDeleteConfirmation())}_renderDeleteConfirmation(){return this.state.showDeleteConfirmation?s.createElement($e.a,{confirmButtonLabel:bt,confirmButtonType:"destructive",headline:vt,onCancel:this._handleHideDeleteConfirmation,onConfirm:this._handleDelete,text:_t}):null}_renderReactionButton(){const{entry:e,perspective:t}=this.props,{actionsAreActive:a}=this.state;return s.createElement(qe,{entry:e,onDismiss:this._handleHideActionsAndMenus(),perspective:t},s.createElement(Je.a,{accessibilityLabel:Et,"aria-expanded":a?"true":"false","aria-haspopup":"true",icon:wt,onPress:this._handlePressReactionPickerButton,size:this._isNarrow?"normalCompact":"normal",type:"text"}))}_renderOverflowButton(){return s.createElement(Je.a,{accessibilityLabel:yt,icon:Ot,onPress:this._handleSetActionsActive,renderMenu:this._renderOverflowMenu,size:this._isNarrow?"normalCompact":"normal",type:"text"})}_areActionsVisible(){const{containerIsActive:e,containerIsFocused:t,containerIsHovered:a,isDraft:i}=this.props,{actionsAreActive:n}=this.state,s=(r=this.props.entry,!it(r)&&nt(r)&&!Xe.a.isEnabled);var r;return!i&&(s||e&&!Xe.a.isEnabled||t||a||n)}}var At=Object(Ne.a)(Ee(Rt));const It=$.a.create(e=>({invisible:{opacity:0},messageActions:{alignSelf:"flex-end",flexDirection:"row"},messageActionsMediaNarrow:{flexDirection:"column"},messageActionsNarrow:{flexShrink:1,flexWrap:"wrap",minWidth:e.spaces.large},messageActionsLeft:{justifyContent:"flex-end",paddingRight:e.spaces.xxSmall},messageActionsRight:{justifyContent:"flex-start",paddingLeft:e.spaces.xxSmall},actionIcon:{color:e.colors.deepGray},visible:{opacity:1}})),wt=s.createElement(mt,{style:It.actionIcon}),Ot=s.createElement(gt.a,{style:It.actionIcon});var Tt=a("97Jx"),kt=a.n(Tt),Mt=a("uDfI");const Lt={createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),removeEntry:c.removeEntry,sendMessage:l.n};var Ft=Object(Mt.b)(null,Lt);const Dt=[],jt=(e,t)=>Object(Te.p)(e,t.entryId)||Dt,Pt=e=>Object(Te.l)(e).entries,Bt={createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_REACTIONS")};var Nt=Object(u.e)(()=>Object(m.createSelector)(Pt,jt,d.g,(e,t,a)=>{const i=Object(De.a)({includeInactive:!0});let n,s=0;return{reactionsWithCounts:t.reduceRight((t,r)=>{const o=e[r]&&e[r].data;if(!o)return t;if(!i.includes(o.reaction_key))return t;const c=(t.get(o.reaction_key)||0)+1;return t.set(o.reaction_key,c),(null==o?void 0:o.sender_id)===a&&(n=o.reaction_key),s+=1,t},new Map),selectedReactionKey:n,totalReactionCount:s}}),Bt),Ut=a("E89d");const Wt=[],Ht=(e,t)=>t.entryId,zt=e=>Object(Te.l)(e).entries,Gt=(e,t)=>Object(Te.p)(e,Ht(0,t))||Wt,Vt=(e,t)=>y.e.selectMany(e,((e,t)=>Object(Te.q)(e,Ht(0,t)))(e,t)),qt={removeReaction:Te.k,fetchUpdatesIfNeeded:Oe.d,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_REACTION_SUMMARY_CONTEXT")};var Yt=Object(u.e)(()=>Object(m.createSelector)(zt,Gt,d.g,Vt,(e,t,a,i)=>{const n=Object(De.a)({includeInactive:!0}),s=[];t.forEach(t=>{const r=e[t]&&e[t].data;if(!(r&&n.includes(r.reaction_key)))return;const o=i.find(e=>e&&e.id_str===r.sender_id),c=o&&{avatarUri:o.profile_image_url_https,userId:o.id_str,reactionKey:r.reaction_key,isLoggedInUser:o.id_str===a,screenName:o.screen_name,name:o.name,isProtected:o.protected,isVerified:o.verified,time:r.time};c&&s.push(c)}),s.sort((e,t)=>t.time-e.time);const r=s.findIndex(e=>e.userId===a);return r>-1&&s.push(...s.splice(0,r)),{loggedInUserId:a,usersWithReactions:s}}),qt),Kt=a("TIdA"),Qt=a("htQn");const $t=Re.a.gf5e9ea6,Jt=Re.a.a2d48778,Xt=Kt.a.createLayoutCache();class Zt extends s.Component{constructor(...e){super(...e),n()(this,"_handleUndoReaction",e=>{const{onUndoPress:t}=this.props;e.stopPropagation(),t()})}render(){const{user:e,renderUndo:t,withBottomBorder:a}=this.props,{avatarUri:i,name:n,screenName:r,isProtected:o,isVerified:c}=e,l=s.createElement(de.default,{imageLayoutCache:Xt,screenName:r,size:"xxLarge",uri:i}),d=s.createElement(Pe,{accessible:!1,emojiSize:"xLarge",emotion:e.reactionKey}),p=s.createElement(Z.a,{badgeContext:"content",isProtected:o,isVerified:c,name:n,screenName:r,withHoverCard:!0,withStackedLayout:!0});return s.createElement(Qt.a,{link:{pathname:"/"+r,anchorless:!0},style:[ea.root,a&&ea.bottomBorder]},s.createElement(ce.a,{style:ea.reactionColumn},d),s.createElement(ce.a,{style:ea.column},l),s.createElement(ce.a,{style:ea.bodyColumn},s.createElement(ce.a,{style:ea.body},p)),t?s.createElement(ce.a,{style:ea.column},s.createElement(Je.a,{accessibilityLabel:Jt({emoji:Object(De.b)(e.reactionKey)}),onClick:this._handleUndoReaction,size:"normalCompact",type:"text"},$t)):null)}}const ea=$.a.create(e=>({bodyColumn:{flexShrink:1,flexGrow:1,justifyContent:"center",marginHorizontal:e.spaces.xxSmall},body:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},bottomBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},column:{alignItems:"center",justifyContent:"center",marginRight:e.spaces.xxSmall},reactionColumn:{alignItems:"center",justifyContent:"center",marginRight:e.componentDimensions.gutterHorizontal},root:{flexDirection:"row",minHeight:"56px",paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical}}));var ta=Zt,aa=a("TnY3"),ia=a("cHvH"),na=a("xKuM"),sa=a("sgih");const ra=Re.a.b772cd65,oa=Re.a.c0098d49,ca=Re.a.j85999eb;class la extends s.PureComponent{constructor(...e){super(...e),n()(this,"_renderContent",()=>s.createElement(s.Fragment,null,s.createElement(ia.a,null,({windowWidth:e})=>{const t=e<$.a.theme.breakpoints.medium;return s.createElement(ce.a,null,this._renderAppBar({isSmallScreen:t}),s.createElement(ce.a,{accessibilityLabel:ca,style:da.container},this._renderUsers()),t?this._renderSmallSheetFooter():null)}))),n()(this,"_renderAppBar",({isSmallScreen:e})=>{const{onClose:t}=this.props;return s.createElement(na.a,{leftControl:e?void 0:s.createElement(Ut.a,{backButtonType:"close",onClick:t}),title:oa,withBottomBorder:!0})}),n()(this,"_renderSmallSheetFooter",()=>{const{onClose:e}=this.props;return s.createElement(Je.a,{key:"button_done",onPress:e,style:da.cancelButton,type:"neutral"},ra)}),n()(this,"_renderUsers",()=>this.props.usersWithReactions.filter(Boolean).map((e,t)=>s.createElement(ta,{history:this.props.history,key:e.userId,onUndoPress:this._reactionUndoHandler(e.reactionKey),renderUndo:e.isLoggedInUser,user:e,withBottomBorder:t!==this.props.usersWithReactions.length-1}))),n()(this,"_reactionUndoHandler",e=>()=>{const{analytics:t,conversationId:a,fetchUpdatesIfNeeded:i,createLocalApiErrorHandler:n,entryId:s,loggedInUserId:r,onClose:o,removeReaction:c}=this.props,l={reaction_key:e,conversation_id:a,dm_id:s,perspective:r};o(),c(l).then(t.scribe({page:"app",section:"twitter_service",component:"direct_messages",element:"delete_reaction",action:"success",data:{reaction_emotion:e}})).then(i).catch(n())})}render(){const{onClose:e}=this.props;return s.createElement(sa.a,{accessibilityRole:"menu",allowBackNavigation:!0,enableMaskForDismiss:!0,onMaskClick:e,style:da.root,type:"bottom",withMask:!0},this._renderContent())}componentDidMount(){const{analytics:e}=this.props;e.scribe({component:"dm_reaction_summary",action:"show"})}}const da=$.a.create(e=>({cancelButton:{marginHorizontal:e.spaces.xSmall,marginVertical:e.spaces.xSmall},container:{overflowY:"scroll",paddingVertical:e.spaces.xSmall,maxHeight:"65vh"},root:{flexGrow:1,flexShrink:1}}));var pa=Object(aa.a)(Object(Ne.a)(Yt(la))),ua=a("7nmT"),ha=a.n(ua);const ma=Re.a.h95f9e76;class ga extends s.PureComponent{constructor(e){super(e),n()(this,"_onSetReactionsNode",e=>{const t=ha.a.findDOMNode(e);this._measureWidths(t instanceof window.HTMLElement?t:void 0)}),n()(this,"_renderReactions",({isHovered:e})=>{const{reactionsWithCounts:t,selectedReactionKey:a}=this.props,i=this.state.emojiSize||"large",n=t.size-1;return Array.from(t,([t,r],o)=>s.createElement(Pe,{accessible:!0,count:r,emojiSize:i,emotion:t,enableHoverStyle:!1,key:t,style:[o===n&&fa.rightPadding,fa.elementPadding,a===t?fa.selfSelect:null,e&&fa.transparentBorder]}))}),n()(this,"_renderReactionSummary",e=>{const{conversationId:t,entryId:a}=this.props;return s.createElement(pa,{conversationId:t,entryId:a,onClose:e})}),this.state={emojiSize:void 0}}render(){const{isEndOfDM:e,isSent:t,totalReactionCount:a}=this.props,{emojiSize:i}=this.state;if(0===a)return null;const n=Q.a.generate({backgroundColor:$.a.theme.colors.fadedGray,color:$.a.theme.colors.deepGray}),r=ma({reactionCount:a});return s.createElement(J.a,{accessibilityLabel:r,accessible:!0,interactiveStyles:n,renderMenu:this._renderReactionSummary,style:[fa.container,e?fa.marginShort:fa.marginLong,t?fa.alignRight:fa.alignLeft,i?fa.visible:fa.invisible],viewRef:this._onSetReactionsNode},this._renderReactions)}_measureWidths(e){const t=e&&e.parentElement,a={emojiSize:"large"};if(t){const{width:i}=t.getBoundingClientRect(),{width:n=0}=e?e.getBoundingClientRect():{};n>i&&(a.emojiSize="small")}this.setState(Object.assign({},a))}}const fa=$.a.create(e=>({container:{borderRadius:e.borderRadii.infinite,boxSizing:"border-box",display:"inline-flex",flexDirection:"row"},rightPadding:{paddingRight:e.spaces.micro},elementPadding:{borderColor:e.colors.transparent,borderWidth:e.borderWidths.small,paddingBottom:e.spaces.micro,paddingTop:e.spaces.micro,paddingLeft:`calc(${e.spaces.micro} * 2)`},selfSelect:{borderColor:$.a.theme.colors.fadedGray,borderRadius:e.borderRadii.infinite},alignLeft:{alignSelf:"flex-start"},alignRight:{alignSelf:"flex-end"},invisible:{opacity:0},visible:{opacity:1},marginShort:{marginBottom:e.spaces.xxSmall},marginLong:{marginBottom:e.spaces.xSmall},transparentBorder:{borderColor:e.colors.transparent}}));var va=Nt(ga);const ba={listTwo:Re.a.b781c1ec,listItems:Re.a.j4bbbbcf,listEnd:Re.a.i653d8ce};const _a=Re.a.icd0bf34,ya=Re.a.e8bd8fec,Ea=Re.a.b2d32fad,Ca=Re.a.a763d33e;class Sa extends s.PureComponent{constructor(e){super(e),n()(this,"_handlePress",e=>{e.stopPropagation(),this.setState({showFullList:!0})}),this.state={showFullList:!1}}render(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:a}=this.props;return s.createElement(ce.a,{style:xa.root},s.createElement(le.c,{align:"right",color:"deepGray",size:"small",style:xa.seenLabel},this._renderSeenLabel()),!t&&e&&a.length?this._renderNameList():null)}_renderSeenLabel(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:a}=this.props;return t?e?Ea:_a:a.length?Ca({count:a.length}):ya}_renderNameList(){let{namesToDisplay:e}=this.props;const{showFullList:t}=this.state,a=!t&&e.length>10,i=e.length-10,n=({namesList:e,othersCount:t})=>s.createElement(Re.a.I18NFormatMessage,{$i18n:"f6464106"},s.createElement(le.c,null,e),s.createElement(le.c,{color:"link",onPress:this._handlePress},Re.a.d7a0722f({othersCount:t})));a&&(e=e.slice(0,10));const r=function(e,t=!1){const a=e.length;let i=e[0];const n=(e,a)=>{if(1===e.length){return(t?ba.listItems:ba.listEnd)({listItem1:a,listItem2:e[0]})}return n(e.slice(1),ba.listItems({listItem1:a,listItem2:e[0]}))};switch(a){case 0:return null;case 1:break;case 2:i=ba.listTwo({listItem1:i,listItem2:e[1]});break;default:i=n(e.slice(1),i)}return i}(e,a);return s.createElement(le.c,{align:"right",color:"deepGray",size:"small",style:xa.namesList},a?s.createElement(n,{namesList:r,othersCount:i}):s.createElement(le.c,null,r))}}const xa=$.a.create(e=>({root:{alignItems:"flex-end",width:`calc(100% - ${e.spaces.micro})`},seenLabel:{cursor:"pointer"},namesList:{marginBottom:e.spaces.micro,whiteSpace:"pre-line"}}));var Ra=Sa,Aa=a("t0aI");const Ia=({entryId:e,participants:t,user:a})=>{const i=Object.keys(t),n=wa({entryId:e,participants:t,user:a});return{namesToDisplay:n,isSeenByEveryone:n.length===i.length-1}},wa=({entryId:e,participants:t,user:a})=>Object.keys(t).reduce((i,n)=>{const{join_conversation_event_id:s,last_read_event_id:r,user:{name:o}}=t[n],c=n!==a.id_str,l=r&&1!==Object(Aa.a)(e,r),d=!s||1!==Object(Aa.a)(s,e);return c&&l&&d&&i.push(o),i},[]);var Oa=a("IMYl"),Ta=a("21zW"),ka=a("gmpV");const Ma=Re.a.fad48ee9,La=Re.a.ba60339a,Fa=Re.a.d338f53e,Da=Re.a.ae7d7a24,ja=Re.a.d725a288,Pa=Re.a.bbe74f3f,Ba=Re.a.h0e4cdf4,Na=Re.a.bfbc051c;class Ua extends s.PureComponent{constructor(...e){super(...e),n()(this,"_handleRemove",()=>{const{conversationId:e,removeEntry:t,entryId:a}=this.props;t(e,null,{id:a})}),n()(this,"_handleTryAgain",()=>{const{sendMessage:e,conversationId:t,localMediaId:a,entryText:i,user:n}=this.props;e({senderId:n.id_str,conversationId:t,text:i,localMediaId:a}),this._handleRemove()})}render(){const{isSent:e}=this.props,t=this._renderSending(),a=this._renderError(),i=this._renderTimestamp(),n=this._renderReadReceipt(),r=this._renderSentCheckmark(),o=this._renderReactions(),c=i||n||r;return(t||a||o||c)&&s.createElement(ce.a,{style:[Wa.root,e&&Wa.sentMessage]},t,a,o,c?s.createElement(ce.a,{style:e&&Wa.sentContainer},s.createElement(ce.a,{style:e&&Wa.groupedItems},i,r),n):null)}_renderError(){const{isError:e}=this.props;return e&&s.createElement(ce.a,null,s.createElement(le.c,{align:"right",color:"deepGray",size:"small"},Da),s.createElement(ce.a,{style:Wa.groupedItems},s.createElement(le.c,{accessibilityRole:"button",color:"red",onPress:this._handleRemove,size:"small",withInteractiveStyling:!0},La),s.createElement(Ta.a,null),s.createElement(le.c,{accessibilityRole:"button",color:"primary",onPress:this._handleTryAgain,size:"small",withInteractiveStyling:!0},Fa)))}_renderReactions(){const{conversationId:e,entryId:t,isLastRapidFire:a,isRapidFire:i,isSent:n}=this.props,r=!i||a;return s.createElement(ce.a,{style:!n&&Wa.footerPadderWithAvatar},s.createElement(va,{conversationId:e,entryId:t,isEndOfDM:r,isSent:n}))}_renderReadReceipt(){const{entryId:e,isActive:t,isDraft:a,isError:i,isGroupDM:n,isSent:r,participants:o,user:c}=this.props;return t&&r&&!a&&!i?s.createElement(Ra,kt()({isGroupDM:n},Ia({entryId:e,participants:o,user:c}))):null}_renderSending(){const{isDraft:e,isError:t}=this.props;return e&&!t&&s.createElement(le.c,{align:"right",color:"deepGray",size:"small"},Ma)}_renderSentCheckmark(){const{entryId:e,isDraft:t,isError:a,isLastRapidFire:i,isRapidFire:n,isSent:r,participants:o,user:c}=this.props,{isSeenByEveryone:l}=Ia({entryId:e,participants:o,user:c});return!r||t||a||n&&!i?null:s.createElement(le.c,{color:l?"primary":"deepGray",style:Wa.checkmarkContainer},s.createElement(Oa.a,{style:Wa.checkmark}))}_renderTimestamp(){const{entryTime:e,isDraft:t,isGroupDM:a,isError:i,isLastRapidFire:n,isRapidFire:r,isSent:o,user:{name:c}}=this.props;if(t||i||r&&!n)return null;const l=new Date(Number(e));let d;d=Object(ka.b)(l)?ja(l):Object(ka.c)(l)?Pa({time:ja(l)}):Object(ka.d)(l)?Ba(l):Na(l);const p=a&&!o,u=o?"right":"left",h=!o;return s.createElement(ce.a,{style:[h&&Wa.footerPadderWithAvatar,o&&Wa.timestamp]},s.createElement(le.c,{align:u,color:"deepGray",size:"small",withInteractiveStyling:o||!Xe.a.isEnabled},p&&s.createElement(Re.a.I18NFormatMessage,{$i18n:"c8b914d4"},s.createElement(le.c,null,c)),p&&" ",d))}}const Wa=$.a.create(e=>({root:{marginTop:e.spaces.micro,overflow:"hidden",width:"87.5%"},sentMessage:{alignSelf:"flex-end",justifyContent:"flex-end"},sentContainer:{flexDirection:"column"},groupedItems:{justifyContent:"flex-end",flexDirection:"row"},timestamp:{cursor:"pointer"},checkmark:{cursor:"pointer",flexShrink:0,height:"1rem",paddingLeft:e.spaces.micro},checkmarkContainer:{lineHeight:"1"},footerPadderWithAvatar:{marginLeft:`calc(${e.spaces.xLarge} + ${e.spaces.xSmall})`}}));var Ha=Object(T.c)()(Ft(Ua)),za=a("jtO7");const Ga=$.a.create(e=>({root:{borderColor:e.colors.fadedGray,borderStyle:"solid",borderWidth:"1px",borderBottomWidth:0,boxSizing:"border-box",overflow:"hidden"},isLast:{borderBottomWidth:"1px"},insideTopRoundedSent:{borderTopLeftRadius:"1.25rem"},insideTopRoundedReceived:{borderTopRightRadius:"1.25rem"},outsideTopRoundedSent:{borderTopRightRadius:"1.25rem"},outsideTopRoundedReceived:{borderTopLeftRadius:"1.25rem"},sentLast:{borderBottomLeftRadius:"1.25rem"},receivedLast:{borderBottomRightRadius:"1.25rem"}}));var Va=({insideTopRounded:e,isSent:t,isLast:a,label:i,onClick:n,tcoUrl:r,outsideTopRounded:o})=>{const c=[Ga.root,a&&Ga.isLast,a&&t&&Ga.sentLast,a&&!t&&Ga.receivedLast,e&&t&&Ga.insideTopRoundedSent,e&&!t&&Ga.insideTopRoundedReceived,o&&t&&Ga.outsideTopRoundedSent,o&&!t&&Ga.outsideTopRoundedReceived];return s.createElement(ce.a,{style:c},s.createElement(za.a,{align:"center",color:"primary",label:i,link:r,onClick:n,withBottomBorder:!1}))},qa=a("fs1G");class Ya extends s.Component{componentDidMount(){this.props.onImpression()}render(){const{callToActions:e,isSent:t,onCtaClick:a,withSticker:i,withUserText:n}=this.props,r=e.map((r,o)=>{const c=0===o;return s.createElement(Va,{insideTopRounded:c&&(i||!n),isLast:o===e.length-1,isSent:t,key:o,label:r.label,onClick:a,outsideTopRounded:c&&i,tcoUrl:r.tco_url})});return s.createElement(ce.a,null,r)}}n()(Ya,"defaultProps",{onCtaClick:qa.a,onImpression:qa.a});var Ka=Ya,Qa=a("vjRr");const $a=Object(m.createSelector)((e,t)=>Qa.a.createManyHydratedSelector([t.cardUrl])(e)[0],e=>({card:e})),Ja={popOutConversation:c.popOutConversation};var Xa=Object(u.g)($a,Ja);const Za=$.a.create(e=>({root:{width:"100%"},invisible:{opacity:0},visible:{opacity:1}}));var ei=({attachmentContent:e,attachmentHeader:t,isVisible:a=!0,textContent:i})=>s.createElement(ce.a,{style:[a?Za.visible:Za.invisible,Za.root]},t,e,i),ti=a("cTG8");const ai=({excludeCardUrl:e,isActive:t=!1,isFailedDraft:a,isFirstRapidFire:i=!1,isRapidFire:n=!1,isSent:r,hasAssociatedAttachment:o,messageData:c={},rootStyle:l,tweetId:d,withCta:p,withMediaLinks:u,withMessageBubble:h})=>{const m=[l,h&&ii.messageTextContainer,h&&r&&ii.sent,h&&!r&&ii.received,a&&ii.failedDraft,n&&!i&&!r&&ii.rapidFireReceived,n&&!i&&r&&ii.rapidFireSent,o&&r&&ii.hasAssociatedAttachmentSent,o&&!r&&ii.hasAssociatedAttachmentReceived,h&&t&&r&&ii.activeSent,h&&t&&!r&&!Xe.a.isEnabled&&ii.activeReceived,p&&ii.withCta],g=[ii.tweetText,h&&ii.textAlignLeft,!h&&r&&ii.textAlignRight],{white:f,text:v,primary:b,faintGray:_,red:y}=$.a.theme.colors,E=Q.a.generate({color:r?f:v,backgroundColor:a?y:r?b:_}),C=c.text&&c.text.length||0;return s.createElement(J.a,{accessibilityRole:"none",interactive:r,interactiveStyles:h?E:null,style:m},s.createElement(ti.a,{color:$.a.isDarkMode()||r?"whiteOnColor":void 0,displayTextRange:[0,C],entities:c.entities,excludeCardUrl:e,linkColor:h&&r||$.a.isDarkMode()?"whiteOnColor":"link",linkify:!0,quotedTweetId:d,size:h?void 0:"jumbo",style:g,text:c.text||"",underlineLinks:!0,withMediaLinks:u}))},ii=$.a.create(e=>({tweetText:{overflow:"hidden"},messageTextContainer:{borderRadius:"1.25rem",boxSizing:"border-box",maxWidth:"100%",paddingVertical:e.spaces.xSmall,paddingHorizontal:e.spaces.small},textAlignLeft:{textAlign:"left"},textAlignRight:{textAlign:"right"},sent:{alignSelf:"flex-end",backgroundColor:e.colors.primary,borderBottomRightRadius:0,borderColor:e.colors.primary},received:{alignSelf:"flex-start",backgroundColor:e.colors.dmReceivedBubbleBackground,borderBottomLeftRadius:0,borderColor:e.colors.lightGray},activeSent:{backgroundColor:e.colors.lightPrimary},activeReceived:{backgroundColor:e.colors.lightGray},failedDraft:{backgroundColor:e.colors.red},rapidFireReceived:{borderTopLeftRadius:0},rapidFireSent:{borderTopRightRadius:0},withCta:{borderBottomRightRadius:0,borderBottomLeftRadius:0},hasAssociatedAttachmentSent:{borderTopRightRadius:0},hasAssociatedAttachmentReceived:{borderTopLeftRadius:0}}));ai.defaultProps={withMediaLinks:!1};var ni=ai,si=a("NnR4");class ri extends s.Component{constructor(...e){super(...e),n()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),n()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:a}=this.state;if(a!==t){const e={attachmentWidth:t};this.setState(e)}}),n()(this,"_handlePopOutDM",()=>{const{conversationId:e,popOutConversation:t}=this.props;e&&t(e)}),n()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:a}=this.state;if(a!==t){const e={textContentWidth:t};this.setState(e)}})}render(){const{card:e,hasUserText:t,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:p,textContentWidth:u}=this.state,h=rt(t,p,u),m=h.isAttachmentSquared?"both":o?"right":"left",g=s.createElement(ce.a,{onClick:this._handlePopOutDM,onLayout:this._handleAttachmentLayout},s.createElement(si.a,{card:{name:e.name,url:e.url,binding_values:e.hw_card_binding_values,users:e.users},cardContext:{tweetUserId:c.sender_id},dmSentOrReceived:o?"sent":"received",withSquareBottomBorderRadius:m})),f=t?s.createElement(ce.a,{onLayout:this._handleTextContentLayout,style:o?oi.sentMessageWrapper:oi.receivedMessageWrapper},s.createElement(ni,{excludeCardUrl:e.url,hasAssociatedAttachment:!0,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,rootStyle:h.isTextSquared?o?oi.textSentSquared:oi.textReceivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return s.createElement(ei,{attachmentContent:g,isVisible:h.compositeRendered,textContent:f})}}n()(ri,"defaultProps",{hasUserText:!1});const oi=$.a.create(e=>({attachmentReceivedSquared:{borderBottomRightRadius:0},attachmentSentSquared:{borderBottomLeftRadius:0},card:{marginBottom:e.spaces.micro},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:0},sent:{borderBottomRightRadius:0},textReceivedSquared:{borderTopRightRadius:0},textSentSquared:{borderTopLeftRadius:0}}));var ci=Xa(ri),li=a("oEOe"),di=a("Ssj5");const pi=li.a("rweb/fleets","FETCH_USER_FLEETS"),ui={fleets:{},fleetThreads:{},userFetchStatus:{}};const hi=(e,t)=>e.fleets.fleets[t],mi=(e,t)=>e.fleets.userFetchStatus[t],gi=(e,t)=>(a,i,{api:n})=>{const s=i(),r=t&&hi(s,t),o=mi(s,e),c=li.b(a,{params:{user_id:e},request:n.Fleets.fetchUserFleets});return o===g.a.LOADING||r&&r.fetchStatus===g.a.LOADED&&o===g.a.LOADED?Promise.resolve():c({actionTypes:pi,context:"FETCH_USER_FLEETS",meta:{user_id:e,fleet_id:t}})};di.a.register({fleets:function(e=ui,t){switch(t.type){case pi.REQUEST:{const{user_id:a,fleet_id:i}=t.meta;let n;return i&&!e.fleets[i]&&(n={[i]:{fetchStatus:g.a.LOADING}}),Object.assign({},e,{userFetchStatus:Object.assign({},e.userFetchStatus,{[a]:g.a.LOADING}),fleets:Object.assign({},e.fleets,n)})}case pi.SUCCESS:if(t.payload&&t.payload.entities){const{fleets:a,fleetThreads:i}=t.payload.entities,{user_id:n,fleet_id:s}=t.meta;let r={},o={};a&&(r=Object.keys(a).reduce((e,t)=>(e[t]={fetchStatus:g.a.LOADED,data:a[t]},e),{})),i&&(o=Object.keys(i||{}).reduce((e,t)=>(e[t]={fetchStatus:g.a.LOADED,data:i[t]},e),{}));const c=s&&!r[s]&&{[s]:Object.assign({},e.fleets[s],{fetchStatus:g.a.FAILED})};return Object.assign({},e,{fleets:Object.assign({},e.fleets,r,c),fleetThreads:Object.assign({},e.fleetThreads,o),userFetchStatus:Object.assign({},e.userFetchStatus,{[n]:g.a.LOADED})})}break;case pi.FAILURE:{const{user_id:a,fleet_id:i}=t.meta,n=i&&e.fleets[i].fetchStatus===g.a.LOADING&&{[i]:Object.assign({},e.fleets[i],{fetchStatus:g.a.FAILED})};return Object.assign({},e,{fleets:Object.assign({},e.fleets,n),userFetchStatus:Object.assign({},e.userFetchStatus,{[a]:g.a.FAILED})})}default:return e}}});var fi=a("rxPX");const vi=(e,t)=>hi(e,t.fleetId);var bi=Object(fi.a)().propsFromState(()=>({fleet:vi})).propsFromActions(()=>({createLocalApiErrorHandler:Object(h.d)("DM_FLEET_MESSAGE"),fetchUserFleetsIfNeeded:gi})).withAnalytics({page:"messages",section:"fleet"}),_i=a("prG5"),yi=a("wrlS");const Ei=Object.freeze({Original:"ORIG",Large:"LARGE",Medium:"MEDIUM",Small:"SMALL",Thumb:"THUMB"});Object.freeze({Gif:"TWEET_GIF",Image:"TWEET_IMAGE",Video:"TWEET_VIDEO"}),Object.freeze({Hashtag:"hashtag",Mention:"mention",Tweet:"tweet",Text:"text"});var Ci=a("A91F");const Si=Re.a.f720438f,xi=Re.a.cc1030a5,Ri=Re.a.b327c129;function Ai(e){var t;const{fleet:a}=e,i=null==a||null==(t=a.media_entity)?void 0:t.media_url_https,n=yi.a.isTrue("responsive_web_fleets_dm_consumption_enabled"),r=n?Si:xi;if(n&&i&&a){const e=function(e,t){for(let a=0;a<t.media_entity.sizes.length;a++){const i=t.media_entity.sizes[a];if(i.size_type===e)return i}const[a]=t.media_entity.sizes;return a}(Ei.Original,a);return s.createElement(_i.a,{accessibilityLabel:Ri,aspectMode:Ci.a.withinRange(9/16,10),image:{url:i,width:e.width,height:e.height}})}return s.createElement(le.c,{color:"deepGray"},r)}const Ii=e=>{const{message_data:t}=e;if(t){const{time:e}=t;return(new Date).getTime()-parseInt(e,10)>864e5}return!0},wi=Re.a.d9e524a7,Oi=Re.a.b3d08517,Ti=Re.a.ab1dd773,ki=Re.a.f483af99;class Mi extends s.Component{constructor(...e){super(...e),n()(this,"_fleetsDMConsumptionEnabled",yi.a.isTrue("responsive_web_fleets_dm_consumption_enabled")),n()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),n()(this,"_getSquareBottomStyles",e=>{const{isSent:t}=this.props;let a="left";return e?a="both":t&&(a="right"),Li[a]}),n()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:a}=this.state;a!==t&&this.setState({attachmentWidth:t})}),n()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:a}=this.state;a!==t&&this.setState({textContentWidth:t})}),n()(this,"_renderFleet",e=>{const{fleet:t,isSent:a}=this.props,i=!!(null==t?void 0:t.data),n=[this._fleetsDMConsumptionEnabled&&i?Fi.fleetWrapper:Fi.tombstoneWrapper,a?Fi.sentMessageWrapper:Fi.receivedMessageWrapper,this._getSquareBottomStyles(e)];return s.createElement(ce.a,{onLayout:this._handleAttachmentLayout,style:n},s.createElement(Ai,{fleet:null==t?void 0:t.data}))}),n()(this,"_renderFleetAttachmentHeader",()=>{const{isSent:e,withMessageBubble:t}=this.props;let a;return a=e&&t?ki:t?Ti:e?Oi:wi,s.createElement(le.c,{color:"deepGray",size:"small",style:[Fi.attachmentHeader,e?Fi.sentMessageWrapper:Fi.receivedMessageWrapper]},a)}),n()(this,"_renderFleetTextContent",e=>{const{hasUserText:t,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props;return t?s.createElement(ce.a,{onLayout:this._handleTextContentLayout,style:o?Fi.sentMessageWrapper:Fi.receivedMessageWrapper},s.createElement(ni,{hasAssociatedAttachment:!0,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,rootStyle:e?o?Fi.sentSquared:Fi.receivedSquared:void 0,withCta:l,withMessageBubble:d})):null})}componentDidMount(){const{analytics:e,createLocalApiErrorHandler:t,messageData:a,entry:i,fleetId:n,fetchUserFleetsIfNeeded:s}=this.props;e.scribe({element:"fleets_attachment_tombstone",action:"impression"}),this._fleetsDMConsumptionEnabled&&!Ii(i)&&a.recipient_id&&s(a.recipient_id,n).catch(t())}componentDidUpdate(e){const{fleet:t,onIsFleetAvailable:a}=this.props;if(this._fleetsDMConsumptionEnabled&&!Object(oe.a)(t,e.fleet)){a(!!(null==t?void 0:t.data))}}render(){const{hasUserText:e,messageData:t}=this.props,{attachmentWidth:a,textContentWidth:i}=this.state;if(!t||!t.attachment||!t.attachment.fleet)return null;const{compositeRendered:n,isAttachmentSquared:r,isTextSquared:o}=rt(e,a,i);return s.createElement(ei,{attachmentContent:this._renderFleet(r),attachmentHeader:this._fleetsDMConsumptionEnabled?this._renderFleetAttachmentHeader():void 0,isVisible:n,textContent:this._renderFleetTextContent(o)})}}const Li=$.a.create(e=>({both:{borderBottomRightRadius:0,borderBottomLeftRadius:0},left:{borderBottomLeftRadius:0},right:{borderBottomRightRadius:0}})),Fi=$.a.create(e=>({attachmentHeader:{marginBottom:e.spaces.xxSmall},isSent:{borderBottomRightRadius:0},fleetWrapper:{borderRadius:"1.25rem",WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)",width:"100%"},received:{borderBottomLeftRadius:0},receivedMessageWrapper:{alignSelf:"flex-start"},receivedSquared:{borderTopRightRadius:0},sentMessageWrapper:{alignSelf:"flex-end"},sentSquared:{borderTopLeftRadius:0},tombstoneWrapper:{backgroundColor:e.colors.faintGray,borderColor:e.colors.fadedGray,borderRadius:"1.25rem",boxSizing:"border-box",flexDirection:"row",borderWidth:e.borderWidths.small,paddingHorizontal:e.spaces.small,paddingVertical:e.spaces.xSmall,overflow:"auto"}}));var Di=bi(Mi),ji=(a("FtFR"),a("zb92")),Pi=Object(ji.a)({loader:()=>Promise.all([a.e(16),a.e(130)]).then(a.bind(null,"PEyh")).then(e=>({default:e.__DANGEROUS_IMPORT_VIDEOPLAYER__})),renderPlaceholder:()=>null});function Bi(){const e=s.useContext(Gi),[t,a]=e.activeVoiceMessage,[,i]=e.playerApi,[,n]=e.playerState,[,r]=t;const o={media:r,onEnded:function(){a([null,null])},onPlayerApi:i,onPlayerState:n};return s.createElement(Pi,o)}const Ni={activeVoiceMessage:[null,null],playerApi:null,playerState:null};function Ui(e){const t=function(){const e=s.useState(Ni.activeVoiceMessage),t=s.useState(Ni.playerApi),a=s.useState(Ni.playerState);return{activeVoiceMessage:e,playerApi:t,playerState:a}}();return s.createElement(Wi.Provider,{value:t},e.children)}const Wi=s.createContext({activeVoiceMessage:[Ni.activeVoiceMessage,Hi],playerApi:[Ni.playerApi,Hi],playerState:[Ni.playerState,Hi]});function Hi(){throw new Error("DMVoiceContext is not initialized")}function zi(e){return Object(C.c)()?s.createElement(Ui,null,e.children,s.createElement(Bi,null)):e.children}const Gi=Wi;var Vi=a("LdEA"),qi=a.n(Vi);function Yi(e){const{timeMs:t,accessibilityLabelTime:a,humanReadable:i,style:n,short:r}=e,o=qi()(e,["timeMs","accessibilityLabelTime","countdown","humanReadable","style","short","withCountdownSymbol"]);if("number"!=typeof t)return null;const c=on(e),l=rn(c,e),d=`PT${c.hours}H${c.minutes}M${c.seconds}S`;let p;p=r||i?sn(c,function(e){if(e.short)return{seconds:Xi,minutes:en,hours:an};return{seconds:Zi,minutes:tn,hours:nn}}(e)):l;const u=[Ki.timestamp,n],h=a?a(l):$i({time:l});return s.createElement(le.c,kt()({},o,{accessibilityLabel:h,style:u,title:h}),s.createElement("time",{dateTime:d},p))}const Ki=$.a.create(e=>({timestamp:{flexShrink:0,whiteSpace:"nowrap",fontVariant:["tabular-nums"]}})),Qi=e=>e>=10?e:"0"+e,$i=Re.a.ebe41366,Ji=Re.a.efce3d9a,Xi=Re.a.i61fef37,Zi=Re.a.i3b7a017,en=Re.a.ba705e26,tn=Re.a.ie5d110e,an=Re.a.j86b0d8c,nn=Re.a.df5f11b3;const sn=({seconds:e,minutes:t,hours:a},i)=>e||t||a?Ji({seconds:e?i.seconds(e):"",minutes:t?i.minutes(t):"",hours:a?i.hours(a):""}):i.seconds(0),rn=(e,{withCountdownSymbol:t})=>{const a=(({seconds:e,minutes:t,hours:a})=>{const i=Qi(e),n=`${a?Qi(t):t}:${i}`;return a?`${a}:${n}`:n})(e);return t?"-"+a:a},on=e=>{const{timeMs:t,countdown:a,short:i}=e,n=(a?Math.ceil:Math.floor)(t/1e3),s=Math.floor(n/3600),r=Math.floor(n%3600/60),o={seconds:Math.floor(n%60),minutes:r,hours:s};return i&&(s?(o.minutes=0,o.seconds=0):r&&(o.seconds=0)),o};var cn=a("5Ixf"),ln=a("AtEG");function dn(e){var t,a;const i=s.useContext(Gi),{isSent:n}=e;if(!(null==(t=e.media)?void 0:t.video_info))return null;const[r,o]=i.activeVoiceMessage,[c]=i.playerApi,[l]=i.playerState,d={durationMs:(null==(a=e.media)?void 0:a.video_info.duration_millis)||0,isSent:n,onPlayRequest:()=>o([e.messageId,e.media]),playerApi:null,playerState:null},[p]=r||[],u=un(l);return e.messageId===p&&u&&u.contentId===e.media.id_str&&(d.playerApi=c,d.playerState=l),s.createElement(pn,d)}function pn(e){const{isSent:t,playerState:a,playerApi:i}=e,n=!!a,r=null==a?void 0:a.isPlaying,o=un(a),c=(null==o?void 0:o.currentTimeMs)||0,l=(null==o?void 0:o.durationMs)||e.durationMs,d=Math.max(n?l-c:l,0);s.useEffect(()=>{i&&0===c&&i.play()},[i]);const p=$.a.isDarkMode()||t,u=p?"white":"black",h={color:p?"whiteOnColor":"normal"},m=[gn.voiceMessageContainer];return m.push(t?gn.voiceMessageSent:gn.voiceMessageReceived),s.createElement(ce.a,{style:m},s.createElement(Je.a,{accessibilityLabel:r?mn:hn,icon:r?s.createElement(cn.a,{style:{color:u}}):s.createElement(ln.a,{style:{color:u}}),onPress:()=>{if(i){(r?i.pause:i.play)()}else e.onPlayRequest()},size:"normal",type:"invertedText"}),s.createElement(ce.a,{style:gn.durationSpacer}),s.createElement(Yi,kt()({countdown:!0,timeMs:d},h,{color:"deepGray",size:"small",style:p?gn.durationDark:void 0,weight:"bold",withCountdownSymbol:n})))}const un=e=>e?e.tracks[e.currentTrackId]:null,hn=Re.a.c94b7d89,mn=Re.a.eb6f9582,gn=$.a.create(e=>({displayNone:{display:"none"},voiceMessageContainer:{height:e.spaces.xxLarge,paddingLeft:e.spaces.xxSmall,paddingVertical:e.spaces.small,paddingRight:e.spaces.small,display:"flex",alignSelf:"flex-end",flexDirection:"row",alignItems:"center",justifyContent:"center"},voiceMessageSent:{backgroundColor:e.colors.primary},voiceMessageReceived:{backgroundColor:e.colors.dmReceivedBubbleBackground},durationSpacer:{width:e.spaces.xxSmall},durationDark:{color:"rgba(255,255,255,0.75)"}}));var fn=a("RCZO");const vn=Re.a.b327c129,bn=e=>{e.stopPropagation()};var _n=({media:e,mediaUrl:t})=>{const a=e.ext_alt_text||vn,i=e.media_url_https,{width:n,height:r}=e.original_info||{},o=Object(fn.b)(e).rgb,c=s.createElement(_i.a,{accessibilityLabel:a,aspectMode:Ci.a.withinRange(9/16,10),backgroundColor:o,image:{url:i,width:n,height:r},shouldShowAltLabel:!!e.ext_alt_text});return t?s.createElement(J.a,{interactiveStyles:null,link:t,onPress:bn},c):c},yn=a("iOGT"),En=a("TrHT"),Cn=a("Modb"),Sn=a("lklz");var xn=({media:e,messageId:t})=>{const a=e&&Object(En.a)(Sn.b.forDm(t),e);return a?s.createElement(Cn.a,kt()({},a,{aspectRatio:yn.b(e),withPostPlayback:!0})):null};const Rn={scribeAction:o.c};var An=Object(u.b)(Rn);class In extends s.PureComponent{constructor(e,t){super(e,t),n()(this,"_getElement",()=>`untrusted_${this.props.contentType}_interstitial`),n()(this,"_handleClick",()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({hide:!1}),e(Object.assign({},t,{element:this._getElement(),action:"reveal"}))}),this.state={hide:!0}}componentDidMount(){const{scribeAction:e,scribeNamespace:t}=this.props;e(Object.assign({},t,{element:this._getElement(),action:"impression"}))}render(){const{children:e,ctaText:t,description:a,withSquareBottomBorderRadius:i}=this.props;return this.state.hide?s.createElement(ia.a,null,({windowWidth:e})=>{const n=e<$.a.theme.breakpoints.medium;return s.createElement(ce.a,{accessible:!0,style:[On.root,n?{flexDirection:"column"}:{flexDirection:"row",alignItems:"center"},i&&wn[i]]},s.createElement(ce.a,{style:On.description},s.createElement(le.c,null,a)),s.createElement(ce.a,{style:[On.button,n?On.breakButtonWrapper:void 0]},s.createElement(Je.a,{onClick:this._handleClick,size:"normalCompact",style:On.buttonElement,type:"text"},t)))}):e}}const wn=$.a.create(e=>({both:{borderBottomRightRadius:0,borderBottomLeftRadius:0},left:{borderBottomLeftRadius:0},right:{borderBottomRightRadius:0}})),On=$.a.create(e=>({breakButtonWrapper:{marginTop:$.a.theme.spaces.xxSmall,marginLeft:`calc(-1 * ${e.spaces.xSmall})`},button:{flexGrow:1,alignItems:"flex-start"},buttonElement:{paddingHorizontal:e.spaces.xSmall},description:{flexGrow:1,flexShrink:1},root:{backgroundColor:e.colors.faintGray,borderBottomLeftRadius:0,borderColor:e.colors.fadedGray,borderRadius:"1.25rem",boxSizing:"border-box",borderWidth:e.borderWidths.small,maxWidth:"100%",paddingLeft:e.spaces.small,paddingTop:e.spaces.small,paddingBottom:e.spaces.small,paddingRight:e.spaces.xxSmall,overflow:"auto",display:"flex"}}));var Tn=Object(T.c)()(An(In)),kn=a("M7Ix");const Mn=s.createElement(kn.a,null),Ln=Re.a.d9de7b57,Fn=Re.a.f277e949;class Dn extends s.Component{constructor(...e){super(...e),n()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),n()(this,"_renderAttachment",()=>{const{entry:e,hasUserText:t,isFirstRapidFire:a,isRapidFire:i,isSent:n,isTrusted:r,messageData:o}=this.props,{attachmentWidth:c,textContentWidth:l}=this.state,{attachment:d}=o||{},p=e.is_draft,u=rt(t,c,l),h=[jn.mediaAttachment,n&&jn.isSent,!n&&jn.received,n&&u.isAttachmentSquared&&jn.equalComponentDimensionsSent,!n&&u.isAttachmentSquared&&jn.equalComponentDimensionsReceived,i&&!a&&n&&jn.rapidFireSent,i&&!a&&!n&&jn.rapidFireReceived];let m,g,f,v=null;!p&&e.conversation_id&&(v=`/messages/${e.conversation_id}/media/${e.id}`),d&&(d.photo?(m=d.photo,g=s.createElement(_n,{media:m,mediaUrl:v})):d.animated_gif?(m=d.animated_gif,g=s.createElement(xn,{media:m,messageId:e.id})):d.video&&(m=d.video,Object(C.b)(d)?(f=!0,g=s.createElement(dn,{isSent:!!n,media:m,messageId:e.id})):g=s.createElement(xn,{media:m,messageId:e.id})));const b=u.isAttachmentSquared?"both":n?"right":"left",_=m&&g&&this._getMediaContentWithGuard(m,r,g,b);return{attachmentContent:s.createElement(ce.a,{onLayout:this._handleAttachmentLayout,style:h},_),media:m,flags:{renderAttachmentOnly:f}}}),n()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:a}=this.state;if(a!==t){const e={attachmentWidth:t};this.setState(e)}}),n()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:a}=this.state;if(a!==t){const e={textContentWidth:t};this.setState(e)}})}render(){const{entry:e,hasUserText:t,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:p,textContentWidth:u}=this.state,h=e.is_draft,m=rt(t,p,u),{media:g,attachmentContent:f,flags:v}=this._renderAttachment();if(v.renderAttachmentOnly)return f;const b=t?s.createElement(ce.a,{onLayout:this._handleTextContentLayout,style:o?jn.sentMessageWrapper:jn.receivedMessageWrapper},s.createElement(ni,{hasAssociatedAttachment:!0,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:h?c:this._parseMessageData(c,g),rootStyle:m.isTextSquared?o?jn.sentSquared:jn.receivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return s.createElement(ei,{attachmentContent:f,isVisible:m.compositeRendered,textContent:b})}_getMediaContentWithGuard(e,t,a,i){const{displaySensitiveMedia:n}=this.props;return!n&&e.possibly_sensitive?s.createElement(Tn,{contentType:"media",ctaText:Fn,description:Mn,withSquareBottomBorderRadius:i},a):t?a:s.createElement(Tn,{contentType:"media",ctaText:Fn,description:Ln,withSquareBottomBorderRadius:i},a)}_parseMessageData(e,t){const a=e&&e.entities&&e.entities.urls&&t?e.entities.urls.filter(e=>e.display_url!==t.display_url):null;return e&&a?Object.assign({},e,{entities:Object.assign({},e.entities,{urls:a,media:[t]})}):void 0}}n()(Dn,"defaultProps",{hasUserText:!1});const jn=$.a.create(e=>({equalComponentDimensionsSent:{borderBottomLeftRadius:0},equalComponentDimensionsReceived:{borderBottomRightRadius:0},invisible:{opacity:0},isSent:{borderBottomRightRadius:0},mediaAttachment:{borderRadius:"1.25rem",WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},rapidFireReceived:{borderTopLeftRadius:0},rapidFireSent:{borderTopRightRadius:0},received:{borderBottomLeftRadius:0},receivedSquared:{borderTopRightRadius:0},sentSquared:{borderTopLeftRadius:0},visible:{opacity:1}}));var Pn=Dn,Bn=Object(fi.a)().propsFromActions(()=>({markSpamStatus:c.markSpamStatus}));const Nn=Re.a.fd07947f,Un=Re.a.c7a92dc9,Wn=Re.a.f277e949,Hn=Re.a.fb3ccb55;class zn extends s.PureComponent{constructor(...e){super(...e),n()(this,"_handlePress",e=>()=>{const{conversationId:t,dmId:a,markSpamStatus:i}=this.props;i({conversationId:t,dmId:a,markSpam:e})})}render(){const{children:e}=this.props;return s.createElement(Tn,{contentType:"dm",ctaText:Wn,description:Hn},e,this._renderButtons())}_renderButtons(){return s.createElement(ce.a,{style:Vn.buttons},s.createElement(Je.a,{onPress:this._handlePress(!1),style:Vn.leftButton,type:"secondary"},Un),s.createElement(Je.a,{onPress:this._handlePress(!0),type:"secondary"},Nn))}}var Gn=Bn(zn);const Vn=$.a.create(e=>({buttons:{flexDirection:"row",paddingTop:e.spaces.xxSmall},leftButton:{marginRight:e.spaces.xSmall}}));var qn=({isActive:e=!1,isFailedDraft:t,isFirstRapidFire:a=!1,isRapidFire:i=!1,isSent:n,messageData:r,withCta:o,withMessageBubble:c})=>s.createElement(ni,{isActive:e,isFailedDraft:t,isFirstRapidFire:a,isRapidFire:i,isSent:n,messageData:r,withCta:o,withMediaLinks:!0,withMessageBubble:c}),Yn=a("U+bB");const Kn=e=>{const t=e.images,a=t.svg||t.size_1x;if(a)return a.url},Qn=$.a.create(e=>({stickerItem:{height:`calc(3 * ${e.fontSizes.jumbo})`,width:`calc(3 * ${e.fontSizes.jumbo})`}}));var $n=({sticker:e})=>s.createElement(Yn.a,{accessibilityLabel:e.display_name,source:Kn(e),style:Qn.stickerItem}),Jn=Object(fi.a)().propsFromActions(()=>({popOutConversation:c.popOutConversation})),Xn=a("b5s6");const Zn=Re.a.e4df0ad7,es=Re.a.f277e949;class ts extends s.Component{constructor(...e){super(...e),n()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),n()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:a}=this.state;if(a!==t){const e={attachmentWidth:t};this.setState(e)}}),n()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:a}=this.state;if(a!==t){const e={textContentWidth:t};this.setState(e)}}),n()(this,"_handlePopOutDM",()=>{const{conversationId:e,popOutConversation:t}=this.props;e&&t(e)})}render(){const{hasUserText:e=!1,isActive:t=!1,isFailedDraft:a,isFirstRapidFire:i=!1,isRapidFire:n=!1,isSent:r,isTrusted:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:p,textContentWidth:u}=this.state;if(!c||!c.attachment||!c.attachment.tweet)return null;const h=c.attachment.tweet,m=r?"sent":"received",g=rt(e,p,u),f=s.createElement(Xn.a,{onPress:yi.a.isTrue("responsive_web_dm_quick_access_enabled")?this._handlePopOutDM:void 0,style:[as[m],e&&as.attachment,g.isAttachmentSquared?r?as.sentAttachmentSquared:as.receivedAttachmentSquared:void 0],tweetId:h.status}),v=g.isAttachmentSquared?"both":r?"right":"left",b=o?f:s.createElement(Tn,{contentType:"tweet",ctaText:es,description:Zn,withSquareBottomBorderRadius:v},f),_=s.createElement(ce.a,{onLayout:this._handleAttachmentLayout,style:as.attachment},b),y=e?s.createElement(ce.a,{onLayout:this._handleTextContentLayout,style:r?as.sentMessageWrapper:as.receivedMessageWrapper},s.createElement(ni,{hasAssociatedAttachment:!0,isActive:t,isFailedDraft:a,isFirstRapidFire:i,isRapidFire:n,isSent:r,messageData:c,rootStyle:g.isTextSquared?r?as.sentSquared:as.receivedSquared:void 0,tweetId:h.status,withCta:l,withMediaLinks:!0,withMessageBubble:d})):null;return s.createElement(ei,{attachmentContent:_,isVisible:g.compositeRendered,textContent:y})}}const as=$.a.create(e=>({attachment:{marginBottom:0},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:0,borderColor:e.colors.lightGray},receivedAttachmentSquared:{borderBottomRightRadius:0},receivedSquared:{borderTopRightRadius:0},sent:{borderBottomRightRadius:0,borderColor:e.colors.primary},sentAttachmentSquared:{borderBottomLeftRadius:0},sentSquared:{borderTopLeftRadius:0}}));var is=Jn(ts);class ns extends s.Component{constructor(e){super(e),n()(this,"_fleetsDMConsumptionEnabled",yi.a.isTrue("responsive_web_fleets_dm_consumption_enabled")),n()(this,"_handleIsFleetAvailable",e=>{const{isFleetAttachmentAvailable:t}=this.state;e!==t&&this.setState({isFleetAttachmentAvailable:e})}),this.state={isFleetAttachmentAvailable:!Ii(e.entry)}}render(){const{entry:e,isSent:t,onCtaClick:a,onCtaImpression:i}=this.props,{isFleetAttachmentAvailable:n}=this.state,{message_data:r}=e,o=r&&r.attachment?r.attachment:{},c=e.marked_as_spam,l=nt(e),d=!!r&&!!r.ctas,p=it(e),u=(e=>{const{message_data:t}=e;if(!t)return!1;if(nt(e)&&!st(e))return!1;if(!t.text)return!1;const a=Object(tt.parse)(t.text);if(!a||0===a.length)return!1;const i=a.sort((e,t)=>t.indices[1]-e.indices[1]).reduce((e,t)=>`${e.slice(0,t.indices[0])}${e.slice(t.indices[1])}`,t.text).trim();return a.length<=10&&0===i.length})(e),h=!(p&&u),m=st(e);let g;g=o.sticker?s.createElement($n,{sticker:o.sticker}):this._renderDMMessage(p,d,h);const f=c?s.createElement(Gn,{conversationId:e.conversation_id,dmId:e.id},g):g,v=l&&!m&&!Object(C.b)(null==r?void 0:r.attachment),b=[this._fleetsDMConsumptionEnabled&&m&&n&&ss.fleetRoot,t?ss.isSent:ss.isReceived,d&&ss.withCta,v?ss.mediaRoot:ss.flexShrink];return s.createElement(ce.a,{style:b},f,r&&r.ctas?s.createElement(Ka,{callToActions:r.ctas,isSent:t,onCtaClick:a,onImpression:i,withSticker:!!o.sticker||u,withUserText:p}):null)}_renderDMMessage(e,t,a){const{entry:i,isActive:n,isFirstRapidFire:r,isRapidFire:o,isSent:c,isTrusted:l,displaySensitiveMedia:d}=this.props,{message_data:p,error:u}=i,h=p&&Object.assign({},p,{entities:p&&p.entities||void 0,error:u}),m=(null==h?void 0:h.attachment)||{},g={isActive:n,isFailedDraft:!!u,isFirstRapidFire:r,isRapidFire:o,isSent:c,messageData:h,withCta:t,withMessageBubble:a};return m.tweet?s.createElement(is,kt()({conversationId:i.conversation_id,hasUserText:e,isTrusted:l},g)):m.photo||m.animated_gif||m.video?s.createElement(Pn,kt()({displaySensitiveMedia:d,entry:i,hasUserText:e,isTrusted:l},g)):m.card?s.createElement(ci,kt()({cardUrl:m.card,conversationId:i.conversation_id,hasUserText:e},g)):m.fleet?s.createElement(Di,kt()({entry:i,fleetId:m.fleet.fleet_id,hasUserText:e,onIsFleetAvailable:this._handleIsFleetAvailable},g)):s.createElement(qn,g)}}const ss=$.a.create(e=>({flexShrink:{flexShrink:1},fleetRoot:{flex:.7},mediaRoot:{flex:1},isSent:{alignItems:"flex-end"},isReceived:{alignItems:"flex-start"},withCta:{alignItems:"stretch"}}));var rs=ns;const os=$.a.create(e=>({avatar:{borderRadius:e.borderRadii.infinite}}));var cs=({showAvatar:e,size:t="xLarge",user:a})=>e?s.createElement(de.default,{accessibilityLabel:a.name,circle:!0,link:{pathname:"/"+a.screen_name},size:t,style:os.avatar,uri:a.profile_image_url_https}):s.createElement(ce.a,{style:[os.avatar,de.default.getSizeStyle(t)]}),ls=a("uArA"),ds="messageEntry",ps=a("shC7");const us={element:"cta_dm"};class hs extends s.Component{constructor(...e){super(...e),n()(this,"_handleClick",Object(ls.a)(()=>{const{entry:{error:e,id:t,is_draft:a},isActive:i,setActiveEntry:n}=this.props;a||e||(n(i?null:t),this._handleScribeMessageEntryClick())})),n()(this,"_handleScribeMessageEntryClick",()=>{const{isActive:e}=this.props;if(!Xe.a.isEnabled&&!e){const{entry:e}=this.props,t={component:"message",element:Object(C.a)(e),action:"click"};this._scribeAction(t)}}),n()(this,"_handleCtaImpression",()=>{this._scribeAction(Object.assign({},us,{action:"show"}))}),n()(this,"_handleCtaClick",()=>{this._scribeAction(Object.assign({},us,{action:"click"}))}),n()(this,"_isAudioMessage",()=>{var e;return Object(C.b)(null==(e=this.props.entry.message_data)?void 0:e.attachment)})}shouldComponentUpdate(e){return!Object(oe.a)(this.props,e)}render(){const{isActive:e,isSent:t,user:a}=this.props,i=this._getRapidFireProps(),n=i.isRapidFire&&!i.isLastRapidFire,r=[bs.root.base,t?bs.root.sent:bs.root.received,n&&bs.root.footerSpacing];if(!a)return null;const o=!Xe.a.isEnabled||t;return s.createElement(J.a,{accessible:!0,"aria-expanded":o&&e?"true":"false",interactiveStyles:null,onPress:o?this._handleClick:void 0,style:r,testID:ds},({isFocused:e,isHovered:t})=>s.createElement(s.Fragment,null,this._renderMessage({isFocused:e,isHovered:t,rapidFireProps:i}),this._renderFooter(i)))}_renderMessage({isHovered:e,isFocused:t,rapidFireProps:a}){const{displaySensitiveMedia:i,entry:n,isActive:r,isWide:o,isReadOnly:c,isSent:l,isTrusted:d,perspective:p,setShouldFreezeUpdates:u}=this.props,{isFirstRapidFire:h,isRapidFire:m}=a,g=[l?bs.messageContainer.sent:bs.messageContainer.received,o?bs.messageContainer.wide:bs.messageContainer.narrow,l&&o&&bs.messageContainer.sentWide,!l&&o&&bs.messageContainer.receivedWide],f=d&&!c;return s.createElement(ce.a,{style:g},n.error?null:s.createElement(At,{containerIsActive:r,containerIsFocused:t,containerIsHovered:e,entry:n,isDraft:!!n.is_draft,isSent:l,perspective:p,setShouldFreezeUpdates:u,shouldShowReactionButton:f}),s.createElement(rs,{displaySensitiveMedia:i,entry:n,isActive:r,isFirstRapidFire:h,isRapidFire:m,isSent:l,isTrusted:d,key:n.id,onCtaClick:this._handleClick,onCtaImpression:this._handleCtaImpression}),this._possiblyRenderUserAvatar(a))}_renderFooter({isLastRapidFire:e,isRapidFire:t}){var a,i;const{isGroupDM:n,entry:r,isActive:o,isSent:c,participants:l,user:d}=this.props;return s.createElement(Ha,{conversationId:r.conversation_id,entryId:r.id,entryText:null==(a=r.message_data)?void 0:a.text,entryTime:r.time,isActive:o,isDraft:!!r.is_draft,isError:!!r.error,isGroupDM:n,isLastRapidFire:e,isRapidFire:t,isSent:c,localMediaId:null==(i=r.message_data)?void 0:i.localMediaId,participants:l,user:d})}_possiblyRenderUserAvatar({isLastRapidFire:e,isRapidFire:t}){const{isSent:a,user:i}=this.props,n=this._isAudioMessage();if(!i||a&&!n)return null;const r={showAvatar:!!n||(!t||!!e),size:fs,user:i};return a?s.createElement(ce.a,{style:bs.userAvatar.container},s.createElement(ce.a,{style:[bs.userAvatar.base,bs.userAvatar.sent,bs.userAvatar.hiddenVisually]},s.createElement(cs,r))):s.createElement(ce.a,{style:bs.userAvatar.container},s.createElement(ce.a,{style:bs.userAvatar.spacing}),s.createElement(ce.a,{style:bs.userAvatar.messageSpacing}),s.createElement(ce.a,{style:[bs.userAvatar.base,bs.userAvatar.received]},s.createElement(cs,r)))}_scribeAction(e){const{analytics:t}=this.props;t.scribe(Object.assign({},e))}_getRapidFireProps(){const e=this._isAudioMessage();return{isFirstRapidFire:!e&&this.props.isFirstRapidFire,isLastRapidFire:!e&&this.props.isLastRapidFire,isRapidFire:!e&&this.props.isRapidFire}}}n()(hs,"defaultProps",{isGroupDM:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1});var ms=Object(Ne.a)(_e(hs));const gs=$.a.theme.spaces.xSmall,fs="xLarge",vs=$.a.theme.spaces[fs],bs={root:$.a.create(e=>({base:{flexDirection:"column",paddingBottom:e.spaces.medium},received:{cursor:"default",alignItems:"flex-start"},sent:{cursor:"pointer",alignItems:"flex-end"},footerSpacing:{paddingBottom:e.spaces.micro}})),messageContainer:$.a.create(e=>({sent:{flexDirection:"row",justifyContent:"flex-end"},received:{flexDirection:"row-reverse",justifyContent:"flex-end"},narrow:{width:"100%"},wide:{width:"87.5%"},receivedWide:{paddingRight:e.spaces.xSmall},sentWide:{paddingLeft:e.spaces.xSmall}})),userAvatar:$.a.create(e=>({container:{flexDirection:"row",alignItems:"flex-end"},base:{position:"absolute"},sent:{right:0,transformOrigin:ps.a.isRTL?"bottom left":"bottom right"},received:{left:0,transformOrigin:ps.a.isRTL?"bottom right":"bottom left"},spacing:{width:vs},messageSpacing:{width:gs},hiddenVisually:{opacity:0,pointerEvents:"none"}}))};var _s=a("H4nC");class ys extends s.Component{shouldComponentUpdate(e){return!Object(oe.a)(this.props,e)}render(){const{conversation:e,entry:t,isActive:a,isWide:i,isFirstRapidFire:n,isLastRapidFire:r,isRapidFire:o,perspective:l,scribeNamespace:d,setActiveEntry:p,setShouldFreezeUpdates:u}=this.props;if(Object(z.b)(t)||Object(z.e)(t)){const{conversation_id:h,participants:m,read_only:g,trusted:f,type:v}=e,{message_data:{sender_id:b}={}}=t,_=void 0===h||f;return s.createElement(ms,{entry:t,isActive:a,isFirstRapidFire:n,isGroupDM:v===c.CONVERSATION_TYPE.GROUP,isLastRapidFire:r,isRapidFire:o,isReadOnly:g,isSent:b===l,isTrusted:_,isWide:i,participants:m,perspective:l,scribeNamespace:d,senderId:b,setActiveEntry:p,setShouldFreezeUpdates:u})}return Object(z.a)(t)?s.createElement(fe,{conversation:e,entry:t,entryType:t.type,perspective:l}):Object(z.d)(t)?s.createElement(_s.a,{entry:t,isCompact:!1}):null}}n()(ys,"defaultProps",{isActive:!1});const Es=Object(m.createSelector)((e,t)=>{const a=Object(Te.o)(e,t.conversationId),i=a&&Object(V.a)(a);return i&&Object(c.selectEntry)(e,i)},e=>({lastEntry:e}));var Cs=Object(u.c)(Es);a("Ef13");const Ss=Object(m.createSelector)((e,t)=>y.e.selectMany(e,t.userIds||[]),e=>({users:e}));var xs=Object(Mt.b)(Ss),Rs=a("Enqy"),As=a("+/1j");const Is=(e,t)=>e.id_str<t.id_str?-1:e.id_str>t.id_str?1:0,ws={stiffness:1e3,damping:70},Os={scale:Object(Rs.spring)(1,ws),translateY:Object(Rs.spring)(0,ws)},Ts=(e,t)=>({key:e.id_str,data:e,style:Os}),ks=Object(F.a)({translateY:140,scale:0}),Ms=Object(F.a)({scale:Object(Rs.spring)(1,ws),translateY:Object(Rs.spring)(140,ws)}),Ls=[{key:"bubble",style:{scale:Object(Rs.spring)(1,ws),translateY:Object(Rs.spring)(0,ws)}}],Fs=Object(F.a)({translateY:140,scale:0}),Ds=Object(F.a)({scale:Object(Rs.spring)(1,ws),translateY:Object(Rs.spring)(140,ws)}),js=e=>[isFinite(e.scale)&&{scale:e.scale.toFixed(3)},isFinite(e.translateY)&&{translateY:Math.round(e.translateY)+"%"}].filter(Boolean);class Ps extends s.Component{constructor(...e){super(...e),n()(this,"state",{isHidden:!0}),n()(this,"_afterLeave",()=>{const{users:e}=this.props;this.setState(t=>({isHidden:0===e.length}))})}componentDidUpdate(e,t){this.state.isHidden&&this.props.users&&this.props.users.length&&this.setState({isHidden:!1})}shouldComponentUpdate(e,t){return!Object(oe.a)(this.props,e)||!Object(oe.a)(this.state,t)}render(){const{isHidden:e}=this.state,{users:t}=this.props,a=t.sort(Is).slice(0,5).map(Ts);return t.length>5&&a.push({key:"overflow",style:Os}),s.createElement(ce.a,{style:[Bs.root,e&&Bs.hidden]},s.createElement(ce.a,{style:Bs.avatarRow},s.createElement(Rs.TransitionMotion,{styles:a,willEnter:ks,willLeave:Ms},e=>s.createElement(s.Fragment,null,e.map((e,a)=>{if(e.style.scale<=.05)return null;const i=js(e.style);return"overflow"===e.key?s.createElement(ce.a,{key:e.key,style:[Bs.avatar,Bs.avatarSpacer,Bs.overflowAvatar,{transform:i}]},s.createElement(As.a,{style:Bs.overflowAvatarText},"+",t.length-5)):s.createElement(ce.a,{key:e.key,style:[Bs.avatar,{transform:i}]},s.createElement(de.default,{accessibilityLabel:e.data&&e.data.name,size:"xLarge",uri:e.data&&e.data.profile_image_url_https}))})))),s.createElement(Rs.TransitionMotion,{didLeave:this._afterLeave,styles:t.length>0?Ls:[],willEnter:Fs,willLeave:Ds},e=>s.createElement(s.Fragment,null,e.map(e=>s.createElement(ce.a,{key:e.key,style:[Bs.messageBubble,{transform:js(e.style)}]},s.createElement(ce.a,{style:Bs.dot}),s.createElement(ce.a,{style:[Bs.dot,Bs.dot1]}),s.createElement(ce.a,{style:[Bs.dot,Bs.dot2]}))))))}}const Bs=$.a.create(e=>({root:{flexDirection:"row",paddingBottom:e.spaces.medium,paddingRight:e.spaces.xSmall,width:"calc(100% * 7/8)",position:"relative",transitionProperty:"height, padding-bottom",transitionDuration:"0.2s",overflow:"hidden"},hidden:{paddingBottom:0,paddingRight:0,height:0,width:0},avatarRow:{display:"inline-flex",alignItems:"flex-start",flexDirection:"row"},avatar:{marginEnd:e.spaces.xSmall,transformOrigin:"50% 100%"},avatarSpacer:{height:e.spaces.xLarge,width:e.spaces.xLarge},overflowAvatar:{borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.primary,alignItems:"center",justifyContent:"center"},overflowAvatarText:{color:"white"},messageBubble:{alignItems:"center",borderRadius:"1.25rem",maxWidth:"100%",paddingVertical:e.spaces.xSmall,paddingHorizontal:e.spaces.small,backgroundColor:e.colors.fadedGray,borderBottomLeftRadius:0,borderColor:e.colors.lightGray,flexDirection:"row",height:e.spaces.xLarge,overflow:"hidden",transformOrigin:"0% 100%"},dot:{display:"flex-inline",position:"relative",width:e.spaces.xSmall,height:e.spaces.xSmall,overflow:"hidden",borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.deepGray,marginEnd:e.spaces.xxSmall,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationKeyframes:[{"15%":{transform:[{scale:1.4}],backgroundColor:e.colors.primary},"30%":{transform:[{scale:1}]}}]},dot1:{animationDelay:"0.1s"},dot2:{animationDelay:"0.2s"}}));var Ns=xs(Ps),Us=a("tn7R");class Ws extends s.PureComponent{constructor(...e){super(...e),n()(this,"_timers",{}),n()(this,"state",{forceHide:!1,userIds:[]}),n()(this,"_handleLivePipelineUpdate",e=>{const{user_id:t}=e.dm_typing;t!==this.context.loggedInUserId&&(this._timers[t]&&clearTimeout(this._timers[t]),this._timers[t]=setTimeout(()=>this._removeAvatar(t),4e3),this.setState(e=>({forceHide:!1,userIds:[...e.userIds.filter(e=>e!==t),t]})))}),n()(this,"_removeAvatar",(e,t=!1)=>{this.setState(a=>{const i=a.userIds.filter(t=>t!==e);return{forceHide:t&&0===i.length,userIds:i}})})}componentDidMount(){this._initializeLivePipeline()}UNSAFE_componentWillReceiveProps(e){if(e.lastEntry){const{lastEntry:t={}}=this.props||{},{lastEntry:a}=e;t&&t.id!==a.id&&a.message_data&&this._removeAvatar(a.message_data.sender_id,!0)}}componentDidUpdate(e,t){e.conversationId!==this.props.conversationId&&(this._teardownLivePipeline(),this._initializeLivePipeline())}componentWillUnmount(){this._teardownLivePipeline()}render(){const{forceHide:e,userIds:t}=this.state;return!e&&s.createElement(Ns,{conversationId:this.props.conversationId,userIds:t})}_teardownLivePipeline(){Object(Us.a)(this._timers).forEach(e=>clearTimeout(e)),this._livePipelineSubscription&&this._livePipelineSubscription.teardown()}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(r.h)().then(({LivePipeline:t})=>{t.isSupportedAndReady()&&yi.a.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic("/dm_typing/"+e,this._handleLivePipelineUpdate))})}}n()(Ws,"contextType",q.a);var Hs=Cs(Ws),zs=a("yw4N"),Gs=a("9YUM"),Vs=a("Qwev"),qs=a("mw9i");const Ys=Re.a.i859a9d3,Ks=Re.a.i8ecae5b,Qs=Re.a.ffde2fdb,$s=()=>s.createElement(ce.a,{style:Zs.spinner},s.createElement(Vs.a,{accessibilityLabel:Qs})),Js=e=>e.entry.id;class Xs extends s.Component{constructor(e,t){super(e,t),n()(this,"_renderItem",e=>{const{conversation:t}=this.props,a=t.conversation_id;switch(e.type){case B.b.TYPING_INDICATOR:return a?s.createElement(Hs,{conversationId:a}):null;case B.b.READ_ONLY_INDICATOR:return a?s.createElement(ce.a,{style:Zs.readOnly},s.createElement(le.c,{align:"center",color:"deepGray",size:"small"},Ks," ",s.createElement(le.c,{link:"https://support.twitter.com/articles/14606#faq"},Ys))):null;case B.b.CONVERSATION_PROFILE_INFO_HEADER:return s.createElement(ne,{conversation:t});default:return this._renderDMEntry(e)}}),n()(this,"_setActiveEntry",e=>{this.setState({activeEntryId:e})}),n()(this,"_setShouldFreezeUpdates",e=>{this.setState({shouldFreezeUpdates:e})}),this._anchoring=P({isOwnMessage:e=>{var t,a;return(null==(t=e.entry)||null==(a=t.message_data)?void 0:a.sender_id)===this.props.perspective||!1},typingIndicatorId:"typingIndicator"}),this.state={activeEntryId:null,shouldFreezeUpdates:!1}}shouldComponentUpdate(e,t){return!1===t.shouldFreezeUpdates}render(){const{conversation:e,style:t,onHistoryRequest:a}=this.props,{activeEntryId:i}=this.state,n=(({conversation:e,footer:t,readOnlyEntry:a,canInjectConversationProfileInfoHeader:i,activeEntryId:n})=>{const s=e&&e.entries||[],r=s.reduce((e,t,a)=>{i&&0===a&&e.push(U);const r=Object(V.a)(e),o=a===s.length-1;if(e.push({isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,entry:t,isActive:n===t.id}),r){const a=G(r.entry,t),i=e[e.length-2];a?(e[e.length-1].isRapidFire=!0,i.isRapidFire||(i.isFirstRapidFire=!0,i.isRapidFire=!0),o&&(e[e.length-1].isLastRapidFire=!0)):i.isRapidFire&&(i.isLastRapidFire=!0)}return e},[]);return t&&r.push(t),e.read_only&&a&&r.push(a),r})({conversation:e,footer:W,readOnlyEntry:H,canInjectConversationProfileInfoHeader:e.status===B.c.AT_END&&e.type===B.a.ONE_TO_ONE,activeEntryId:i}),r=e.conversation_id;return s.createElement(zs.a,{style:[Zs.scrollContainer,t]},e.status&&e.status!==B.c.AT_END?s.createElement($s,null):null,s.createElement(qs.a,{style:[Zs.content,Zs.alignTop],withGutter:!0},s.createElement(Gs.a,{anchoring:this._anchoring,assumedItemHeight:100,cacheKey:"dm-activity-"+r,identityFunction:Js,initialAnchor:n.length>0?M.a(Js((o=n,o[o.length-1]))):void 0,items:n,nearStartProximityRatio:2,onNearStart:a,renderer:this._renderItem})));var o}_renderDMEntry({entry:e,isActive:t,isFirstRapidFire:a,isLastRapidFire:i,isRapidFire:n}){const{conversation:r,isWide:o,perspective:c,scribeNamespace:l}=this.props;return e&&s.createElement(ys,{conversation:r,entry:e,isActive:t,isFirstRapidFire:a,isLastRapidFire:i,isRapidFire:n,isWide:o,key:e.id,perspective:c,scribeNamespace:l,setActiveEntry:this._setActiveEntry,setShouldFreezeUpdates:this._setShouldFreezeUpdates})}}const Zs=$.a.create(e=>({spinner:{alignItems:"center",marginVertical:"30px"},scrollContainer:{backgroundColor:e.colors.cellBackground,flexGrow:1,maxHeight:"100%",overflowX:"hidden",paddingTop:e.spaces.medium,WebkitOverflowScrolling:"touch"},content:{flexGrow:1,transform:[{translate3d:"0,0,0"}]},alignTop:{justifyContent:"flex-start"},readOnly:{paddingBottom:e.spaces.medium}}));var er=a("uB9N"),tr=a("v//M"),ar=a("J2UM"),ir=a("gpVt"),nr=a("I8M8"),sr=a("7myi"),rr=a("883S"),or=a("z0MJ"),cr=a.n(or),lr=a("Es6L"),dr=a("LsPn"),pr=a("GSsg"),ur=a("EbOo"),hr=a("CKsB"),mr=a("pu5c");const gr=Re.a.f9e45cfb,fr=Re.a.cf74e524,vr=Re.a.f3bb6f4e,br=Re.a.g3f155be,_r=Re.a.cfd2f35d,yr=$.a.create(e=>({roundCorners:{borderRadius:e.borderRadii.large},flatCorners:{borderRadius:0},cancelButton:{marginHorizontal:e.spaces.small,marginVertical:e.spaces.small}}));var Er=({dismiss:e,onReportClick:t,onBlockClick:a,requestorScreenName:i,flatBorders:n=!1,showCancel:r=!1})=>{const o=s.useCallback(()=>{t&&t(),e()},[e,t]),c=s.useCallback(()=>{a&&a(),e()},[e,a]);return s.createElement(ce.a,{accessibilityRole:"dialog",style:n?yr.flatCorners:yr.roundCorners},s.createElement(hr.a,{Icon:mr.a,actionSubText:fr,actionText:gr({screenName:i}),onClick:c}),s.createElement(hr.a,{Icon:ct.a,actionSubText:br,actionText:vr({screenName:i}),onClick:o}),r?s.createElement(Je.a,{onPress:e,style:yr.cancelButton,type:"neutral"},_r):null)};var Cr=Object(fi.a)().propsFromActions(()=>({addToast:p.b,block:y.e.block,createLocalApiErrorHandler:Object(h.d)("UNTRUSTED_CONVERSATION_ACTIONS"),unblock:y.e.unblock})),Sr=a("u0B7"),xr=a("aITJ"),Rr=a("GygS"),Ar=a("vMjK");const Ir=Re.a.ccf2f24e,wr=Re.a.ib3fe8a9,Or=Re.a.da878dcf,Tr=Re.a.d96cf7cd,kr=Re.a.hc52446b,Mr=Re.a.f7e1ad65,Lr={headline:Re.a.gdf4b79f,text:Re.a.bbf83d83,confirmButtonLabel:Re.a.bb1d57b6};class Fr extends s.PureComponent{constructor(e){super(e),n()(this,"_renderCopy",e=>s.createElement(le.c,{style:jr.copy},e?kr:Mr({senderName:this._getTheOtherParticipantFromOneToOneConvo().name}))),n()(this,"_renderActionButtons",e=>s.createElement(ia.a,null,({windowWidth:t})=>{const a=t<=$.a.theme.breakpoints.small;return s.createElement(ce.a,{style:jr.actionsContainer},s.createElement(Dr,{isGroup:e,isMobileLayout:a,onBlockClick:this._handleBlockClick,onReportClick:this._handleReportMenuItemClick,requestorScreenName:this._getTheOtherParticipantFromOneToOneConvo().screenName}),s.createElement(Je.a,{onPress:this._handleLeaveConversationClick,size:"normal",style:a?[jr.actionFullWidth,jr.actionMarginTop]:[jr.actionHalfWidth,jr.actionMarginLeft],type:"destructiveSecondary"},Tr),s.createElement(Je.a,{onPress:this._handleAcceptConversation,size:"normal",style:[jr.actionFullWidth,jr.actionMarginTop],type:"secondary"},Or))})),n()(this,"_renderLeaveConfirmationSheet",()=>s.createElement($e.a,{confirmButtonLabel:Lr.confirmButtonLabel,confirmButtonType:"destructive",headline:Lr.headline,onCancel:this._handleCancelLeave,onConfirm:this._handleConfirmLeave,text:Lr.text})),n()(this,"_renderBlockConfirmationSheet",()=>{const{screenName:e,idStr:t}=this._getTheOtherParticipantFromOneToOneConvo();return s.createElement($e.a,{confirmButtonLabel:Rr.a,confirmButtonType:"destructive",headline:Object(Rr.c)({screenName:e}),onCancel:this._handleBlockLeave,onConfirm:this._createBlockUserHandler(t),text:Object(Rr.b)({screenName:e})})}),n()(this,"_scribeAction",e=>{const{scribeAction:t,scribeNamespace:a}=this.props;t(Object.assign({},a,{action:e}),this._getScribeData())}),n()(this,"_getScribeData",()=>{const{conversation:e}=this.props;return{items:[{conversation_type:e.type===c.CONVERSATION_TYPE.GROUP?1:0}]}}),n()(this,"_handleReportTextClick",()=>{this._scribeAction("report")}),n()(this,"_handleReportMenuItemClick",()=>{const{conversationId:e,history:t,scribeNamespace:a}=this.props;e&&(this._scribeAction("report"),t.push(((e,t,a)=>({pathname:"/i/report/dm_conversation/"+e,state:{clientReferer:t,scribeNamespace:a}}))(e,window.location.pathname,a)))}),n()(this,"_handleLeaveConversationClick",()=>{this.setState({showLeaveConfirmation:!0,showBlockConfirmation:!1})}),n()(this,"_handleBlockClick",()=>{this.setState({showBlockConfirmation:!0,showLeaveConfirmation:!1})}),n()(this,"_handleCancelLeave",()=>{this.setState({showLeaveConfirmation:!1})}),n()(this,"_handleBlockLeave",()=>{this.setState({showBlockConfirmation:!1})}),n()(this,"_handleConfirmLeave",()=>{const{leaveConversation:e,conversation:t,conversationId:a,history:i}=this.props,n=t.type===c.CONVERSATION_TYPE.GROUP?"leave_group":"delete_thread";this.setState({showLeaveConfirmation:!1}),e({conversationId:a}),this._scribeAction(n),i.goBack()}),n()(this,"_handleAcceptConversation",()=>{const{acceptConversation:e,conversationId:t}=this.props;t&&(e(t),this._scribeAction("accept"))}),n()(this,"_createBlockUserHandler",e=>()=>{const{addToast:t,block:a,createLocalApiErrorHandler:i}=this.props;this.setState({showBlockConfirmation:!1}),a(e).then(()=>{t({actionLabel:Ar.c,onAction:this._createUnblockUserHandler(e),text:Ar.a})},i(ur.a)),this._scribeAction("block")}),n()(this,"_createUnblockUserHandler",e=>()=>{const{createLocalApiErrorHandler:t,unblock:a}=this.props;a(e).catch(t(Sr.a)),this._scribeAction("unblock")}),n()(this,"_getTheOtherParticipantFromOneToOneConvo",()=>{const{conversation:e}=this.props,{loggedInUserId:t}=this.context,a=Object(Y.a)(e,t).map(({user:e})=>e),i=a&&a[0];return{name:i&&i.name||"",screenName:i&&i.screen_name||"",idStr:i&&i.id_str||""}}),this.state={showLeaveConfirmation:!1,showBlockConfirmation:!1}}componentDidMount(){this._scribeAction("impression")}render(){const{conversation:e}=this.props,{showBlockConfirmation:t,showLeaveConfirmation:a}=this.state,i=(e&&e.type)===c.CONVERSATION_TYPE.GROUP;return s.createElement(s.Fragment,null,s.createElement(ce.a,{style:jr.root},this._renderCopy(i),this._renderActionButtons(i)),xr.a.isKaiOS()?s.createElement(dr.a,{leftText:Tr,onLeftClick:this._handleLeaveConversationClick,onRightClick:this._handleAcceptConversation,rightText:Or}):null,a?this._renderLeaveConfirmationSheet():null,t?this._renderBlockConfirmationSheet():null)}}n()(Fr,"contextType",q.a);const Dr=({isGroup:e,isMobileLayout:t,onBlockClick:a,onReportClick:i,requestorScreenName:n})=>{const r=t?jr.actionFullWidth:[jr.actionHalfWidth,jr.actionMarginRight],o={backgroundColor:"transparent",borderColor:"deepGray",color:"deepGray",size:"normal"};if(e)return s.createElement(ce.a,{style:r},s.createElement(Je.a,kt()({},o,{onPress:i}),Ir));const c=s.createElement(Je.a,kt()({},o,{renderMenu:t?e=>s.createElement(sa.a,{onMaskClick:e,type:"bottom",withKeyboardNavigation:!0,withMask:!0},s.createElement(Er,{dismiss:e,flatBorders:!0,onBlockClick:a,onReportClick:i,requestorScreenName:n,showCancel:!0})):void 0}),wr);return s.createElement(ce.a,{style:r},t?c:s.createElement(Ve.a,{enableEnterKeyToggle:!0,preferredVerticalOrientation:"up",renderContent:e=>s.createElement(Er,{dismiss:e,onBlockClick:a,onReportClick:i,requestorScreenName:n})},c))},jr=$.a.create(e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:"1px",paddingVertical:e.spaces.medium,paddingHorizontal:e.componentDimensions.gutterHorizontal},copy:{paddingBottom:e.spaces.medium},reportlink:{marginLeft:e.spaces.xxSmall},actionsContainer:{display:"flex",flexWrap:"wrap",flexDirection:"row"},actionFullWidth:{width:"100%"},actionHalfWidth:{width:`calc(50% - ${e.spaces.xxSmall})`},actionMarginRight:{marginRight:e.spaces.xxSmall},actionMarginLeft:{marginLeft:e.spaces.xxSmall},actionMarginTop:{marginTop:e.spaces.xSmall}}));var Pr=Object(T.c)({element:"untrusted_interstitial"})(Cr(Fr)),Br=a("rFBM"),Nr=a("jTgF"),Ur=a("+d3d");const Wr=Re.a.badb01a0,Hr=Re.a.d6b11d9c,zr=Re.a.i7ca1446,Gr=e=>e&&(e.tweet||e.media),Vr=({gifMetadata:e={},tweetAttachment:t,media:a})=>{let i;return t?i={tweet:t}:a?a.mediaFile?i={media:a}:a.externalMediaDetails&&(i={media:a,provider:e.provider,gifUrl:e.url}):i=null,i};class qr extends s.PureComponent{constructor(e){super(e),n()(this,"_composer",s.createRef()),n()(this,"_handleLivePipelineUpdate",()=>{this._fetchUpdatesIfNeeded(),this._updatePolling&&this._updatePolling.restart()}),n()(this,"_fetchUpdatesIfNeeded",()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:a,isDmReceiptSettingEnabled:i}=this.props;a(i?{active_conversation_id:e,dm_users:!0}:{}).catch(t())}),n()(this,"_handleInitialFetch",()=>{this._initialFetch()}),n()(this,"_initialFetch",()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchInboxIfNeeded:a,fetchUpdatesIfNeeded:i}=this.props;return a().then(()=>{if(e)return this._fetchConversation(e).then(()=>this._requestWelcomeMessage(e))}).then(()=>i()).catch(t()).finally(()=>{this._updatePolling&&this._updatePolling.start()})}),n()(this,"_isUntrustedConversation",e=>{const{isNewGroupConversation:t}=this.props;return!(null==e?void 0:e.trusted)&&!t}),n()(this,"_leaveConversation",e=>{const{createLocalApiErrorHandler:t,leaveConversation:a}=this.props;a(e).catch(t({showToast:!0}))}),n()(this,"_acceptConversation",e=>{const{acceptConversation:t,createLocalApiErrorHandler:a}=this.props;t(e).then(()=>{xr.a.isMobileOS()&&this._fetchConversation(e)}).catch(a({showToast:!0}))}),n()(this,"_renderActions",()=>{const{conversation:e,conversationId:t,history:a,scribeAction:i}=this.props;return e&&this._isUntrustedConversation(e)?e.read_only?null:t&&s.createElement(Pr,{acceptConversation:this._acceptConversation,conversation:e,conversationId:t,history:a,leaveConversation:this._leaveConversation,scribeAction:i}):s.createElement(s.Fragment,null,this._renderComposerBar(),xr.a.isKaiOS()?s.createElement(dr.a,{leftText:zr,onLeftClick:this._handleInfoClick,onRightClick:this._handleComposeClick,rightText:Wr}):null)}),n()(this,"_render",()=>{const{conversation:e,conversationId:t,isWide:a,perspective:i,scribeNamespace:n}=this.props,{attachment:r,composerHeight:o}=this.state;return s.createElement(zi,{key:t},s.createElement(Br.a,{allowDragDrop:!Gr(r),onFilesAdded:this._handleDragDrop,style:Yr.dragDrop},s.createElement(zs.a,{style:[Yr.scrollView,!Object(lr.a)()&&!this._isUntrustedConversation(e)&&{paddingBottom:o}]},i&&e?s.createElement(Xs,{conversation:e,isWide:a,onHistoryRequest:this._handleHistoryRequest,perspective:i,scribeNamespace:n,style:Yr.activity}):null),this._renderActions()))}),n()(this,"_handleNavHeightChange",e=>{this.setState({composerHeight:e+"px"})}),n()(this,"_handleTyping",()=>{this._throttleSaveDraftText(),this._throttleUpdateTyping()}),n()(this,"_throttleUpdateTyping",Object(Ur.a)(()=>{const{conversationId:e,createLocalApiErrorHandler:t,updateTyping:a}=this.props;e&&a({conversationId:e}).catch(t())},2e3,{trailing:!1})),n()(this,"_throttleSaveDraftText",Object(Ur.a)(()=>{const{conversationId:e}=this.props;e&&this._handleSaveDraftText()},1e3,{leading:!1})),n()(this,"_handleDragDrop",e=>{this._composer.current&&this._composer.current._handleAddMediaFiles(e)}),n()(this,"_handleHistoryRequest",()=>{const{conversationId:e,fetchConversationHistory:t,createLocalApiErrorHandler:a}=this.props;t({conversationId:e}).catch(a())}),n()(this,"_handleSendMessage",(e,t)=>{const{addToast:a,cardUrl:i,conversationId:n,createLocalApiErrorHandler:s,gifMetadata:r,history:o,location:c,newConversationParticipants:l,perspective:d,scribeAction:p,scribeNamespace:u,sendMessage:h,tweetAttachment:m}=this.props;if(e.emoji||e.quickReply||(this._composer.current&&this._composer.current.clear(),this._composer.current&&this._composer.current.focus()),r&&p(Object.assign({},u,{element:"remote",action:"send_gif_dm"})),p(m?Object.assign({},u,{action:"send_tweet_dm"}):Object.assign({},u,{action:"send_dm"})),!n){return h({senderId:d,recipients:l&&l.map(({data:e})=>e.id_str),text:t,tweetAttachment:m}).then(e=>{this.setState({attachment:null}),o.replace("/messages/"+e)},s(rr.b)),Promise.resolve()}return this.state.attachment&&(this.setState({attachment:null}),o.replace(c.pathname)),h(Object.assign({senderId:d,cardUrl:i,conversationId:n,text:t,tweetAttachment:m},e.quickReply&&{quickReply:e.quickReply})).catch(e=>{if(!Object(Nr.d)(e)||e.code!==nr.b.CANCELED)if(Object(Nr.d)(e)){const t=Object(Nr.b)(e,Hr);t&&a(t)}else s(rr.b)(e)})}),n()(this,"_handlePopOutConvo",()=>{const{conversationId:e,popOutConversation:t}=this.props;t(e)}),n()(this,"_handleInfoClick",()=>{const{history:e,conversationId:t}=this.props;t&&e.push(`/messages/${t}/info`)}),n()(this,"_handleComposeClick",()=>{this._composer.current&&this._composer.current.focus()}),n()(this,"_handleSaveDraftText",()=>{const{conversationId:e,saveText:t}=this.props;e&&this._composer.current&&t(e,this._composer.current.value())}),this.state={attachment:Vr(e),composerHeight:$.a.theme.componentDimensions.appBarHeight},this._showDMQuickAccess=yi.a.isTrue("responsive_web_dm_quick_access_enabled")}componentDidMount(){const{googleAnalyticsPageView:e,scribeNamespace:t,scribePageImpression:a,updateTweetDetailNav:i}=this.props;return a(t),i(t),e(t),this._initializePolling({interval:3e3}),this._initializeLivePipeline(),this._focusComposerIfNeeded(),this._initialFetch()}_focusComposerIfNeeded(){cr()(()=>Object(ar.a)().then(({detectedType:e,KEYBOARD:t,MOUSE:a})=>{const i=this.props.quickReplyOptions;(e(t)||e(a))&&!i&&this._composer.current&&this._composer.current.focus()}))}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(r.h)().then(({LivePipeline:t})=>{e&&t.isSupportedAndReady()&&yi.a.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic("/dm_update/"+e,this._handleLivePipelineUpdate),this._initializePolling({interval:1e4}))})}_initializePolling({interval:e}){this._updatePolling&&this._updatePolling.stop(),this._updatePolling=new pr.a(this._fetchUpdatesIfNeeded,{interval:e})}componentWillUnmount(){const{conversation:e,conversationId:t,removeConversation:a}=this.props,i=(null==e?void 0:e.entries)||[];this._updatePolling&&this._updatePolling.stop(),this._updatePolling=void 0,this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),0===i.length&&a(t),1===i.length&&"welcome_message_create"===i[0].type&&a(t)}componentDidUpdate(e,t){const{conversationId:a,conversation:i,isLoaded:n,isUploading:s,quickReplyOptions:r,updateConversationReadState:o}=this.props;var c;a!==e.conversationId?(a&&this._fetchConversation(a),this._focusComposerIfNeeded(),this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),this._initializeLivePipeline()):((null==i?void 0:i.sort_event_id)!==(null==(c=e.conversation)?void 0:c.sort_event_id)&&o(a),s||!e.isUploading||r||this._composer.current&&this._composer.current.focus(),e.isLoaded&&!n&&a&&this._fetchConversation(a))}UNSAFE_componentWillReceiveProps(e){const{media:t}=this.props,{media:a}=e;Object(oe.a)(t,a)||this.setState({attachment:Vr(e)})}render(){const{fetchStatus:e}=this.props;return s.createElement(qs.a,{style:[Yr.root,xr.a.isKaiOS()&&Yr.kaiOSFix]},s.createElement(tr.a,{fetchStatus:e,onRequestRetry:this._handleInitialFetch,render:this._render}))}_renderComposerBar(){const{addMedia:e,cardUrl:t,conversation:a,conversationId:i,dataSaverMode:n,draftText:r,dtabBarInfo:o,history:c,isUploading:l,mediaMetadata:d,mediaUploadProgress:p,quickReplyOptions:u,removeMedia:h,richTextInputContext:m,scribeNamespace:g,typeaheadWrapper:f}=this.props,{attachment:v}=this.state,b=this.props.prefillText||r,_=!Object(lr.a)();return(null==a?void 0:a.read_only)?null:s.createElement(er.a,{attachment:v,conversationId:i,disabled:l,dtabBarInfo:o,history:c,isCardPreviewTombstoned:Object(ir.c)(t),isUploading:l,key:i,mediaMetadata:d,mediaUploadProgress:p,onAddMedia:e,onBlur:this._handleSaveDraftText,onHeightChange:this._handleNavHeightChange,onSend:this._handleSendMessage,onTyping:n?this._throttleSaveDraftText:this._handleTyping,prefillText:"string"==typeof b?b:void 0,quickReplyOptions:u,ref:this._composer,removeMedia:h,richTextInputContext:m,scribeNamespace:g,style:[!_&&Yr.offsetBottom],typeaheadWrapper:f})}_fetchConversation(e){const{createLocalApiErrorHandler:t,fetchConversationIfNeeded:a,updateConversationReadState:i}=this.props;return a({conversationId:e}).then(()=>i(e)).catch(t(Object(k.a)(e)))}_requestWelcomeMessage(e){const{addWelcomeMessageToConversation:t,createLocalApiErrorHandler:a,conversation:i,location:n}=this.props,{text:s}=n.query,r=Array.isArray(n.query.welcome_message_id)?n.query.welcome_message_id[0]:n.query.welcome_message_id,o=!!this.state.attachment||!(!s||r),l=!i||!i.type||i.type===c.CONVERSATION_TYPE.GROUP,d=i&&i.participants&&Object.keys(i.participants).length<=1;return o||l||d?Promise.resolve():t(e,r).catch(a({showToast:!1}))}}n()(qr,"defaultProps",{isNewGroupConversation:!1,typeaheadWrapper:sr.a});const Yr=$.a.create(e=>({root:{flexGrow:1},activity:{flexBasis:"1px",flexGrow:1,height:"100%"},kaiOSFix:{paddingBottom:20},dragDrop:{flexGrow:1},scrollView:{flexGrow:1},infoButton:{marginRight:e.spaces.xxSmall},offsetBottom:{paddingBottom:$.a.iPhoneOffsetBottom}}));t.a=Object(T.c)()(O(qr))},"X/yg":function(e,t,a){"use strict";a.d(t,"f",(function(){return n})),a.d(t,"e",(function(){return s})),a.d(t,"d",(function(){return r})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return c})),a.d(t,"b",(function(){return l}));var i=a("wrlS");const n=(e,t)=>t.location&&t.location.state&&t.location.state.tweetAttachment,s=(e,t)=>t.location&&t.location.state&&t.location.state.participants,r=(e,t)=>t.location&&t.location.state&&t.location.state.isNewGroupConversation,o=e=>{const{message_data:t}=e;let a="text_bubble";const i=t&&t.attachment||{};return i.tweet?a="tweet":i.photo?a="photo":i.animated_gif?a="gif":i.video?a=i.video.audio_only?"voice_message":"video":i.card&&(a="card"),a};function c(){return i.a.isTrue("dm_voice_rendering_enabled")}function l(e){return!!(e&&e.video&&c())&&!!e.video.audio_only}},XnpN:function(e,t,a){"use strict";a("kYxP");var i=a("aWyx"),n=a("t0aI");const s=(e=0)=>new Date(Number(e)),r=(e,t)=>s(e.join_time)-s(t.join_time),o=({user:e},{user:t})=>Object(n.a)(e.id_str,t.id_str);var c=a("tn7R"),l=a("VIKJ");t.a=(e,t)=>{const{participants:a,type:n,created_by_user_id:s}=e,d=Object(c.a)(a),[p,u]=Object(l.a)(d,({user:e})=>e.id_str===t);return u.length?n===i.a.GROUP&&1===u.length?[...p,...u]:s?u.sort(((...e)=>(t,a)=>e.map(e=>e(t,a)).filter(e=>!!e)[0]||0)((e=>({user:t},{user:a})=>{switch(e){case t.id_str:return-1;case a.id_str:return 1;default:return 0}})(s),r,o)):u:p}},aA19:function(e,t,a){"use strict";var i=a("ERkP"),n=a("aWyx"),s=a("XnpN"),r=a("rHpw"),o=a("9Xij"),c=a("cm6r"),l=a("TIdA"),d=a("A91F"),p=a("oSwX"),u=a("U+bB"),h=a("MWbm");const m=r.a.create(e=>({root:{borderRadius:e.borderRadii.infinite,overflow:"hidden"},container:{height:"auto",overflow:"hidden",width:"100%"},image:{borderRadius:0}})),g=r.a.create(e=>({container:{flexDirection:"row"},left:{flex:1},right:{flex:1,marginLeft:e.borderWidths.small,marginRight:`calc(-1 * ${e.borderWidths.small})`}})),f=r.a.create(e=>({container:{flexDirection:"column"},top:{flex:1,marginBottom:e.borderWidths.small},bottom:{flex:1}})),v=({left:e,right:t})=>i.createElement(h.a,{style:g.container},i.createElement(h.a,{style:g.left},e),i.createElement(h.a,{style:g.right},t)),b=({top:e,bottom:t})=>i.createElement(h.a,{style:f.container},i.createElement(h.a,{style:f.top},e),i.createElement(h.a,{style:f.bottom},t));class _ extends i.Component{render(){const{link:e,conversation:t,perspective:a}=this.props,n=t&&t.avatar_image_https,r=t?Object(s.a)(t,a).map(({user:e})=>e):[],l=r.slice(0,3),d=this._avatarFromGroup(t)||this._avatarFromSrc(n)||this._avatarFromParticipants(l),p=e||this._defaultLink(t,r);return d?i.createElement(o.a,{ratio:1,style:m.root},p?i.createElement(c.a,{interactiveStyles:null,link:p},d):d):null}_defaultLink(e,t){if(e)return e.type===n.a.GROUP?`/messages/${e.conversation_id}/participants`:e.type===n.a.ONE_TO_ONE?"/"+t[0].screen_name:void 0}_avatarFromGroup(e){const t=e&&e.avatar&&e.avatar.image&&e.avatar.image.original_info;return t?i.createElement(l.a,{accessibilityLabel:"",aspectMode:d.a.SQUARE,backgroundColor:r.a.theme.colors.fadedGray,image:t,rounded:!0}):null}_avatarFromSrc(e){return e?i.createElement(u.a,{source:e}):null}_avatarFromParticipants(e){const t=e.length;return 0===t?null:1===t?this._singleParticipantAvatar(e[0]):this._multipleParticipantAvatar(e)}_singleParticipantAvatar(e){const{size:t}=this.props;return i.createElement(h.a,{key:e.id_str,style:m.container},i.createElement(p.default,{importantForAccessibility:"no-hide-descendants",size:t||"xxLarge",style:m.image,uri:e.profile_image_url_https}))}_multipleParticipantAvatar(e){const t=e.length,a=e.map((e,a)=>{const n=2===t||3===t&&0===a?.5:1;return i.createElement(h.a,{key:e.id_str,style:m.container},i.createElement(p.default,{aspectRatio:n,circle:!1,importantForAccessibility:"no-hide-descendants",size:"custom",style:m.image,uri:e.profile_image_url_https}))});if(2===t)return i.createElement(v,{left:a[1],right:a[0]});{const e=i.createElement(b,{bottom:a[2],top:a[1]}),t=a[0];return i.createElement(v,{left:e,right:t})}}}t.a=_},b5s6:function(e,t,a){"use strict";var i=a("ERkP"),n=a("rxPX"),s=a("XOJV");const r=(e,t)=>t.tweetId;var o=Object(n.a)().propsFromState(()=>({tweet:s.a.createHydratedTweetSelector(r)})),c=a("VoLI");const l=o(({dmType:e,isCondensed:t,style:a,tweet:n,onPress:s})=>i.createElement(c.a,{dmType:e,isCondensed:t,onPress:s,style:a,tweet:n}));t.a=l},b9JY:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"e",(function(){return s})),a.d(t,"d",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return l}));var i=a("aWyx");const n=e=>e&&e.type===i.b.MESSAGE,s=e=>e&&e.type===i.b.WELCOME_MESSAGE,r=e=>e&&e.type===i.b.TRUST_CONVERSATION,o=e=>e&&e.type===i.b.REACTION_CREATE,c=[i.b.CONVERSATION_AVATAR_UPDATE,i.b.CONVERSATION_NAME_UPDATE,i.b.JOIN_CONVERSATION,i.b.PARTICIPANTS_JOIN,i.b.PARTICIPANTS_LEAVE],l=e=>e&&c.indexOf(e.type)>-1},g54k:function(e,t,a){"use strict";a.d(t,"b",(function(){return c}));var i=a("oEGd"),n=a("hqKg"),s=a("s1N3");var r=e=>{const{sender_id:t,by_user_id:a,participants:i=[]}=e;return Object(s.a)(i.map(({user_id:e})=>e).concat([t,a]).filter(Boolean))},o=a("G6rE");const c=(e,t)=>({users:r(t).reduce((t,a)=>(t[a]=e[a],t),{})}),l=Object(n.createSelector)(o.e.selectAll,(e,t)=>t.entry,c);t.a=Object(i.c)(l)},hiGS:function(e,t,a){"use strict";a("IAdD");var i=a("ERkP"),n=a("Lsrn"),s=a("k/Ka");const r=(e={})=>Object(s.a)("svg",Object.assign({},e,{style:[n.a.root,e.style],viewBox:"0 0 24 24"}),i.createElement("g",null,i.createElement("path",{d:"M20.746 5.236h-3.75V4.25c0-1.24-1.01-2.25-2.25-2.25h-5.5c-1.24 0-2.25 1.01-2.25 2.25v.986h-3.75c-.414 0-.75.336-.75.75s.336.75.75.75h.368l1.583 13.262c.216 1.193 1.31 2.027 2.658 2.027h8.282c1.35 0 2.442-.834 2.664-2.072l1.577-13.217h.368c.414 0 .75-.336.75-.75s-.335-.75-.75-.75zM8.496 4.25c0-.413.337-.75.75-.75h5.5c.413 0 .75.337.75.75v.986h-7V4.25zm8.822 15.48c-.1.55-.664.795-1.18.795H7.854c-.517 0-1.083-.246-1.175-.75L5.126 6.735h13.74L17.32 19.732z"}),i.createElement("path",{d:"M10 17.75c.414 0 .75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75v7c0 .414.336.75.75.75zm4 0c.414 0 .75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75v7c0 .414.336.75.75.75z"})));r.metadata={width:24,height:24},t.a=r},"n+Zb":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return n}));const i=e=>({id:e,distanceToViewportTop:0}),n=e=>({id:e,distanceToViewportBottom:0})},p9G8:function(e,t,a){"use strict";a.d(t,"b",(function(){return p}));a("kYxP");var i=a("aWyx"),n=a("XnpN"),s=a("3XMw"),r=a.n(s);const o=r.a.g755fcde,c=r.a.f6b1ff81,l=r.a.d27cf5ef,d=r.a.fc0cd235;t.a=(e,t)=>{const{type:a,name:s,participants:r={}}=e;if(a===i.a.GROUP&&s)return s;if(!Object.keys(r).length)return;const o=Object(n.a)(e,t).map(({user:e})=>e);return p(o,t,a)};const p=(e=[],t,a=i.a.GROUP)=>{const n=e.filter(e=>e.id_str!==t),[s,...r]=n;switch(n.length){case 0:return o;case 1:return a===i.a.GROUP?c({name:s.name}):s.name;case 2:return l({name1:s.name,name2:r[0].name});default:{const e=n.map(e=>e.name).join(", ");return d({names:e})}}}},uB9N:function(e,t,a){"use strict";a("IAdD"),a("DZ+c"),a("tVqn");var i=a("KEM+"),n=a.n(i),s=a("ERkP"),r=a("1YZw"),o=a("rxPX"),c=a("zh9S"),l=a("P1r1"),d=a("AspN"),p=Object(o.a)().propsFromState(()=>({dataSaverMode:l.j})).propsFromActions(()=>({addMedia:d.b,addToast:r.b,processMultipleMedia:d.d,removeMediaUpload:d.e,scribeAction:c.c,uploadMedia:d.k})),u=a("wpu3"),h=(a("jQ/y"),a("kYxP"),a("HPNB")),m=a("MWbm"),g=a("1oWZ"),f=a("t62R"),v=a("rHpw");class b extends s.Component{constructor(...e){super(...e),n()(this,"_handleClick",()=>{const{id:e,label:t,onClick:a}=this.props;a({id:e,label:t})})}render(){const{description:e,label:t,isWide:a}=this.props;return s.createElement(g.a,null,s.createElement(m.a,{accessibilityRole:"button",onClick:this._handleClick,style:[_.root,a&&_.isWide,!a&&_.isNarrow]},s.createElement(f.c,{weight:"bold"},t),s.createElement(f.c,{color:"deepGray",size:"small"},e)))}}const _=v.a.create(e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderStyle:"solid",paddingLeft:"1rem",paddingVertical:"1rem"},isWide:{borderRadius:e.borderRadii.large,paddingVertical:"0.5rem",borderWidth:e.borderWidths.small},isNarrow:{borderTopWidth:e.borderWidths.small}}));var y=b,E=a("cHvH"),C=a("mw9i");a("aWzz");class S extends s.Component{constructor(...e){super(...e),n()(this,"_handleOptionChoose",e=>{const{onOptionChoose:t,quickReplyOptions:{id:a}}=this.props;return t(a,e)})}render(){const{quickReplyOptions:{options:e}}=this.props,t=1===e.length;return s.createElement(E.a,null,({windowWidth:a})=>{const i=h.a.isTwoColumnLayout(a),n=[i&&x.isWide,i&&t&&x.oneButtonOnly,!i&&x.isNarrow];return s.createElement(C.a,{style:n,withGutter:i},e.map(e=>this.renderOption(e,i)))})}renderOption(e,t){return s.createElement(y,{description:e.description,id:e.id,isWide:t,key:e.id,label:e.label,onClick:this._handleOptionChoose})}}const x=v.a.create(e=>({oneButtonOnly:{gridTemplateColumns:"1fr"},isWide:{backgroundColor:e.colors.faintGray,display:"grid",gridColumnGap:e.spaces.xSmall,gridRowGap:e.spaces.xSmall,gridTemplateColumns:"1fr 1fr",paddingVertical:e.spaces.xSmall},isNarrow:{maxHeight:"168px",overflow:"auto"}}));var R=S,A=a("krmn"),I=a("JYMr");class w extends s.Component{constructor(...e){super(...e),n()(this,"state",{currentStepIndex:-1})}componentDidMount(){this._scheduleNextStep(0)}componentWillUnmount(){this._currentTimeoutId&&clearTimeout(this._currentTimeoutId)}render(){const{steps:e}=this.props,{currentStepIndex:t}=this.state,a=t>=0&&t<e.length?e[t].progress:0;return s.createElement(I.a,{progress:a})}_scheduleNextStep(e){const{steps:t}=this.props;e<t.length&&(this._currentTimeoutId=setTimeout(()=>{this._currentTimeoutId=void 0,this.setState({currentStepIndex:e}),this._scheduleNextStep(e+1)},t[e].waitMs))}}n()(w,"defaultProps",{steps:[{waitMs:1e3,progress:.1},{waitMs:1400,progress:.3},{waitMs:1800,progress:.5},{waitMs:2400,progress:.6},{waitMs:3e3,progress:.9}]});var O=a("cIoY"),T=a("w3n3"),k=a("MLl7"),M=a("3XMw"),L=a.n(M),F=a("J2UM"),D=a("VPdC"),j=a("pKoL"),P=a("eyty"),B=a("oQhu"),N=a("Dtul"),U=a("Es6L"),W="dmComposerAttachments",H="dmComposerTextInput",z="dmComposerSendButton",G=a("GZwR"),V=a("aITJ"),q=a("6OUF"),Y=a("9Xij"),K=a("/yvb"),Q=a("0FVZ"),$=a("gpVt"),J=a("Lsrn"),X=a("k/Ka");const Z=(e={})=>Object(X.a)("svg",Object.assign({},e,{style:[J.a.root,e.style],viewBox:"0 0 24 24"}),s.createElement("g",null,s.createElement("path",{d:"M21.13 11.358L3.614 2.108c-.29-.152-.64-.102-.873.126-.23.226-.293.577-.15.868l4.362 8.92-4.362 8.92c-.143.292-.08.643.15.868.145.14.333.212.523.212.12 0 .24-.028.35-.087l17.517-9.25c.245-.13.4-.386.4-.664s-.155-.532-.4-.662zM4.948 4.51l12.804 6.762H8.255l-3.307-6.76zm3.307 8.26h9.498L4.948 19.535l3.307-6.763z"})));Z.metadata={width:24,height:24};var ee=Z;const te=(e={})=>Object(X.a)("svg",Object.assign({},e,{style:[J.a.root,e.style],viewBox:"0 0 24 24"}),s.createElement("g",null,s.createElement("path",{d:"M19 13.5H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0 6H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0-12H5c-.828 0-1.5-.672-1.5-1.5S4.172 4.5 5 4.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5z"})));te.metadata={width:24,height:24};var ae=te;const ie=(e={})=>Object(X.a)("svg",Object.assign({},e,{style:[J.a.root,e.style],viewBox:"0 0 24 24"}),s.createElement("g",null,s.createElement("path",{d:"M19 13H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0 6H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0-12H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1z"})));ie.metadata={width:24,height:24};var ne=ie,se=a("iySH");const re=L.a.ee230734,oe=L.a.ca0ce0e4,ce=L.a.cdcebd22,le=L.a.e3275464,de=L.a.ic8c615d,pe=L.a.a04077c4,ue=e=>!(!e||!e.media),he=Object(u.b)({maxNumberOfPhotos:1}),me=s.createElement(ee,null);class ge extends s.Component{constructor(e,t){super(e,t),n()(this,"_handleLayout",e=>{const{onHeightChange:t}=this.props,{mediaButtonsCollapsible:a}=this.state,i=e.nativeEvent.layout;i&&(Object(U.a)()||t&&t(i.height),i.width<=v.a.theme.breakpoints.small&&!a?this.setState({mediaButtonsCollapsible:!0}):i.width>v.a.theme.breakpoints.small&&a&&this.setState({mediaButtonsCollapsible:!1}))}),n()(this,"_renderQuickReplyPicker",()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t}=this.state;return e&&t?s.createElement(R,{onOptionChoose:this._handleQROptionSelection,quickReplyOptions:e}):null}),n()(this,"_renderComposeBox",()=>s.createElement(m.a,{style:fe.composeBoxContainer},this._renderMainContent())),n()(this,"_renderMainContent",()=>{const{typeaheadWrapper:e}=this.props,{value:t}=this.state,a=e;return a?s.createElement(a,{contextText:t,isInline:!0,onTextUpdated:this._handleTextChange,onTypeaheadStateChange:this._handleTypeaheadStateChange,source:G.d.ComposeMessage},this._renderFieldTextInput):this._renderFieldTextInput()}),n()(this,"_renderFieldTextInput",e=>{const{disabled:t,placeholderText:a,richTextInputContext:i}=this.props,n=V.a.isKaiOS()?ce:a||oe,{editorState:r,value:o}=this.state,c=!!i,l=i?{editorState:r,element:i.element}:void 0;return s.createElement(q.a,{contentAbove:this._renderAttachments(),editable:!t,emojiPickerButton:this._renderEmojiPicker(),handleReturn:c?this._handleReturn:void 0,inputStyle:fe.composeTextInput,maxNumberOfLines:c?8:4,multiline:!0,numberOfLines:1,onBlur:this._handleOnBlur,onChange:e?this._getHandleChange(e):this._handleTextChange,onFilesAdded:this._handleAddMediaFiles,onFocus:this._handleTextInputFocus,onKeyPress:c?void 0:this._handleReturn,placeholder:n,ref:this._setTextInputRef,richTextInputContext:l,style:fe.composeInput,testID:H,useCacheForDOMMeasurements:!this._isSendDisabled(),value:o})}),n()(this,"_getHandleChange",Object(B.a)(e=>t=>{e(t),this._handleTextChange(t)})),n()(this,"_handleTypeaheadStateChange",e=>{this.setState({isTypeaheadActive:e})}),n()(this,"_renderAttachments",()=>{const{attachment:e,conversationId:t,isCardPreviewTombstoned:a,isShareViaDM:i,isUploading:n,mediaMetadata:r}=this.props,{value:o}=this.state,{height:c,width:l}=e&&(e.media&&e.media.mediaFile||e.provider&&e.media&&e.media.externalMediaDetails)||{},d=null==e?void 0:e.media,p=d&&d.id.toString(),u=r&&p&&r[p]&&r[p].altText,h=r&&p&&r[p]&&r[p].defaultAltText,g=Object($.b)(o);return s.createElement(s.Fragment,null,d?s.createElement(m.a,{style:fe.attachmentContainer,testID:W},s.createElement(Y.a,{ratio:l/c,style:fe.aspectContainer},s.createElement(m.a,{style:fe.mediaPreviewContainer},s.createElement(j.a,{accessibilityLabel:u||h,mediaItem:d,onClick:this.canEditImage?this._handleClickMediaDetail:void 0,onEdit:this.canEditImage?this._handleClickMediaDetail:void 0,onRemove:this._handleRemoveMedia(d.id),resizeIfNeeded:"width",style:[fe.mediaPreview],withAltTextLabel:!!u,withCloseButton:!n,withEditButton:this.canEditImage&&!n}))),e&&e.provider&&e.gifUrl&&s.createElement(m.a,{style:fe.gifAttribution},s.createElement(O.a,{gifUrl:e.gifUrl,provider:e.provider}))):g&&!i?s.createElement($.a,{conversationId:t,isCardPreviewTombstoned:a,style:fe.cardPreviewContainer,urls:g}):null)}),n()(this,"_renderEmojiPicker",()=>{const{withEmojiPicker:e}=this.props;return e&&V.a.isDesktopOS()?s.createElement(A.a,{disabled:this.props.disabled,onEmojiSelect:this._handleEmojiSelect,onPress:this._handleTextInputFocus,size:"normalCompact",textInputRef:this._textInput||void 0}):null}),n()(this,"_renderActionButton",e=>{const{quickReplyOptions:t}=this.props,a=this._hasMessageText();return!t||a||e?s.createElement(K.a,{accessibilityLabel:le,disabled:this._isSendDisabled(),icon:me,onPress:this._handleSend,size:"normal",style:fe.actionButton,testID:z,type:"text"}):this._renderQRToggleButton()}),n()(this,"_renderQRToggleButton",()=>{const{isQuickReplyOpen:e}=this.state;return s.createElement(K.a,{accessibilityLabel:de,icon:e?s.createElement(ae,null):s.createElement(ne,null),onPress:this._handleQuickReplyPickerToggle,size:"normal",style:fe.actionButton,type:"text"})}),n()(this,"_renderComposer",()=>{const{attachment:e}=this.props,t=ue(e),a=this._renderComposeBox(),i=this._renderActionButton(t);return s.createElement(m.a,{style:[fe.composer,t&&fe.composerWithAttachment]},t?null:this._renderMediaButtons(),a,i)}),n()(this,"_renderMediaButtons",()=>{const{withGifPicker:e,withMediaPicker:t}=this.props,{mediaButtonsCollapsed:a,mediaButtonsCollapsible:i}=this.state,n=i&&a;return s.createElement(m.a,{style:fe.uploadButtons},n?s.createElement(K.a,{accessibilityLabel:re,icon:s.createElement(se.a,null),onMouseDown:this._handleShowMediaControlsMouseDown,type:"text"}):null,t&&!n?this._renderMediaPicker():null,e&&!n?this._renderGifButton():null)}),n()(this,"_handleShowMediaControlsMouseDown",()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({mediaButtonsCollapsed:!1}),e(Object.assign({},t,{component:"dm_composer",element:"toggle",action:"expand"}))}),n()(this,"_handleReturn",e=>{const{nativeEvent:{ctrlKey:t,key:a,metaKey:i,shiftKey:n}}=e,s="Enter"===a,{isTypeaheadActive:r}=this.state;if(!r&&s&&this._keyboardOrMouseDetected&&!(n||i||t))return e.preventDefault(),this._handleSend(e),"handled"}),n()(this,"_handleClickMediaDetail",()=>{const{attachment:e,conversationId:t,history:a}=this.props;if(this.canEditImage){const i=e&&e.media?e.media.id:0;a.push("/messages/compose/media",{mediaId:i,conversationId:t,tab:"crop"})}}),n()(this,"_handleAddMediaFiles",e=>{const{addMedia:t,addToast:a,dataSaverMode:i,onAddMedia:n,processMultipleMedia:s,removeMediaUpload:r,removeMedia:o,uploadMedia:c}=this.props;t(e,{location:P.c.Dm}).then(e=>{const t=e.map(e=>e.id);this._validateMedia(e)?(n&&n(t),s(e,{onFailure:o}).then(e=>{i||c(e.map(e=>e.id),{preUpload:!0})})):(a({text:pe}),r(t))})}),n()(this,"_handleEmojiSelect",e=>{const{editorState:t}=this.state,{richTextInputContext:a}=this.props;if(!a)return;const i=a.insertTextAtCursor(t,e.text);this._handleTextChange(i)}),n()(this,"_handleRemoveMedia",e=>()=>{this.props.removeMedia&&this.props.removeMedia(e)}),n()(this,"_handleSend",e=>{if(!this._isSendDisabled()){const{onSend:t}=this.props;this._textInput&&this._textInput.applyFinalValue(a=>{t(e,a)}),this._closeQuickReplyPicker()}}),n()(this,"_handleTextChange",e=>{const{onTyping:t,richTextInputContext:a}=this.props,{value:i}=this.state;let n;if(a){const t=e.getCurrentContent().getPlainText(),i=a.convertEmojiToEntities(e);n=t,this.setState({editorState:i,value:n})}else n=e.target.value,this.setState({value:n});i!==n&&t&&t()}),n()(this,"_handleOnBlur",()=>{const{onBlur:e}=this.props,{mediaButtonsCollapsible:t}=this.state;e&&e(),t&&this.setState({mediaButtonsCollapsed:!1})}),n()(this,"_handleTextInputFocus",()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t,mediaButtonsCollapsible:a}=this.state;e&&t&&this._closeQuickReplyPicker(),a&&this.setState({mediaButtonsCollapsed:!0})}),n()(this,"_handleQROptionSelection",(e,t)=>{const{onSend:a,disabled:i}=this.props;i||(a({quickReply:{id:e,selected_id:t.id}},t.label),this._closeQuickReplyPicker())}),n()(this,"_handleQuickReplyPickerToggle",()=>{this.setState({isQuickReplyOpen:!this.state.isQuickReplyOpen})}),n()(this,"_validateMedia",e=>!ue(this.props.attachment)&&he(e)),n()(this,"_detectKeyboardOrMouse",e=>{const{registerSome:t,KEYBOARD:a,MOUSE:i}=e;t(()=>{this._keyboardOrMouseDetected=!0},[a,i])}),n()(this,"_isSendDisabled",()=>{const{attachment:e,canSendEmptyMessage:t,disabled:a,isUploading:i}=this.props,n=ue(e),s=this._hasMessageText()||t,r=!(!e||!e.media)&&(e.media.needsProcessing||i);return a||!s&&!n||r||i}),n()(this,"_hasMessageText",()=>!!(this.state.value||"").trim()),n()(this,"_closeQuickReplyPicker",()=>{this.setState({isQuickReplyOpen:!1})}),n()(this,"_setTextInputRef",e=>{this._textInput=e});const{richTextInputContext:a,prefillText:i}=e,{initEditorState:r}=a||{};this.state={isQuickReplyOpen:!0,value:i,editorState:r&&r(i),isTypeaheadActive:!1,mediaButtonsCollapsed:!1,mediaButtonsCollapsible:!1}}componentDidMount(){Object(F.a)().then(this._detectKeyboardOrMouse),this._unlockReload=N.a.acquire()}componentWillUnmount(){this._unlockReload()}componentDidUpdate(){this.props.quickReplyOptions&&this.state.isQuickReplyOpen&&this._textInput&&this._textInput.blur()}UNSAFE_componentWillReceiveProps(e){const t=this.props.quickReplyOptions,a=e.quickReplyOptions;t&&!a?this.setState({isQuickReplyOpen:!1}):(!t&&a||t&&a&&t.id!==a.id)&&this.setState({isQuickReplyOpen:!0}),this.props.conversationId!==e.conversationId&&this.clear()}render(){const{dtabBarInfo:e,placeholderText:t,mediaUploadProgress:a,isSending:i,isUploading:n,style:r}=this.props,o=t||oe,c=Object(U.a)()?s.Fragment:Q.a.BottomComposer,l=Object(U.a)()&&e&&(e.dtabAll||e.ttsToken)&&!e.hide;return s.createElement(c,null,s.createElement(m.a,{accessibilityLabel:o,accessibilityRole:"complementary",onLayout:this._handleLayout,style:[fe.root,l&&fe.dtabOffset,r]},i&&!n?s.createElement(w,null):s.createElement(I.a,{progress:i?Math.max(a,.02):0}),this._renderComposer(),this._renderQuickReplyPicker()))}_renderMediaPicker(){return s.createElement(D.a,{onChange:this._handleAddMediaFiles,style:fe.mediaPicker,type:"text"})}_renderGifButton(){const{conversationId:e,history:t}=this.props;return s.createElement(T.a,{dmConversationId:e,enabled:!0,gifSearchKeySource:k.a.DMComposition,history:t})}get canEditImage(){const{attachment:e}=this.props;return!!(e&&e.media&&e.media.mediaFile&&e.media.mediaFile.isImage)}clear(){const{richTextInputContext:e}=this.props;if(e){const{initEditorState:t}=e||{};this.setState({value:"",editorState:t&&t("")})}else this.setState({value:""})}focus(){this._textInput&&this._textInput.focus()}value(){return this.state.value}}n()(ge,"defaultProps",{prefillText:"",withEmojiPicker:!0,withGifPicker:!0,withMediaPicker:!0});const fe=v.a.create(e=>({root:{backgroundColor:e.colors.navigationBackground,borderTopColor:e.colors.borderColor,borderTopWidth:e.borderWidths.small},attachmentContainer:{maxHeight:"10rem",margin:e.spaces.xSmall},aspectContainer:{flexShrink:1},cardPreviewContainer:{margin:e.spaces.xSmall},dtabOffset:{marginBottom:e.spaces.xLarge},gifAttribution:{flexDirection:"row",marginVertical:e.spaces.xxSmall,marginHorizontal:0},mediaPicker:{margin:0},icon:{color:e.colors.primary,fontSize:"1.5em"},composeBoxContainer:{flexGrow:1,flexShrink:1,alignSelf:"center"},composeInput:{width:"100%"},composeTextInput:{paddingVertical:e.spaces.xxSmall},mediaPreviewContainer:{flexDirection:"row",height:"100%"},mediaPreview:{borderRadius:e.borderRadii.large,overflow:"hidden"},composer:{alignItems:"flex-end",flexDirection:"row",padding:e.spaces.xxSmall,width:"100%"},composerWithAttachment:{paddingLeft:e.spaces.xSmall},actionButton:{marginLeft:e.spaces.xxSmall},uploadButtons:{flexDirection:"row",marginRight:e.spaces.xxSmall}}));t.a=p.forwardRef(ge)},zQEV:function(e,t,a){"use strict";a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return m}));var i=a("ERkP"),n=a("t62R"),s=a("aWyx"),r=a("3XMw"),o=a.n(r);a("aWzz");const c=o.a.c1d4ac83,l=o.a.abc7b032,d=o.a.i263b293,p=({conversationId:e,children:t})=>i.createElement(n.c,{link:`/messages/${e}/participants`},t),u=(e,t)=>e>=2?i.createElement(o.a.I18NFormatMessage,{$i18n:"e3534476"},i.createElement(p,{conversationId:t},o.a.d1242bcc({count:e}))):i.createElement(o.a.I18NFormatMessage,{$i18n:"b6656850",count:e}),h=({entry:e,users:t})=>e.participants?i.createElement("span",null,e.participants.map(({user_id:e},a)=>{const s=t[e];return s?i.createElement("span",{key:a},a>0?", ":null,i.createElement(n.c,null,s.name)):null})):null,m=(e,t,a,r)=>{const p=a===e.by_user_id;let u;switch(t){case s.b.CONVERSATION_AVATAR_UPDATE:return u=e.by_user_id&&r[e.by_user_id]&&r[e.by_user_id].name,u?p?c:(e=>i.createElement(o.a.I18NFormatMessage,{$i18n:"bff29c94"},i.createElement(n.c,null,e)))(u):l;case s.b.CONVERSATION_NAME_UPDATE:{const t=i.createElement(n.c,null,e.conversation_name);return u=e.by_user_id&&r[e.by_user_id]&&r[e.by_user_id].name,u?p?(e=>i.createElement(o.a.I18NFormatMessage,{$i18n:"b16e4d45"},e))(t):((e,t)=>i.createElement(o.a.I18NFormatMessage,{$i18n:"c5760698"},i.createElement(n.c,null,e),t))(u,t):(e=>i.createElement(o.a.I18NFormatMessage,{$i18n:"a72730a0"},e))(t)}case s.b.JOIN_CONVERSATION:return u=e.sender_id&&r[e.sender_id]&&r[e.sender_id].name,u?(e=>i.createElement(o.a.I18NFormatMessage,{$i18n:"fa95b019"},i.createElement(n.c,null,e)))(u):d;case s.b.PARTICIPANTS_LEAVE:return(e=>i.createElement(o.a.I18NFormatMessage,{$i18n:"fc10875e"},e))(i.createElement(h,{entry:e,users:r}));case s.b.PARTICIPANTS_JOIN:u=e.sender_id&&r[e.sender_id]&&r[e.sender_id].name;return((e,t)=>e?i.createElement(o.a.I18NFormatMessage,{$i18n:"a4bc88c2"},i.createElement(n.c,null,e),t):i.createElement(o.a.I18NFormatMessage,{$i18n:"bfdff0c3"},t))(u,i.createElement(h,{entry:e,users:r}));default:return""}}}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.DMDrawer~bundle.DirectMessages~bundle.DMRichTextCompose.43d70185.js.map