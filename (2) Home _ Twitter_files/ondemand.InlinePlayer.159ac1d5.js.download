(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{QHXq:function(e,t,i){"use strict";i.r(t),i.d(t,"InlinePlayerContainer",(function(){return se}));i("IAdD");var s=i("97Jx"),n=i.n(s),a=i("LdEA"),r=i.n(a),o=i("KEM+"),l=i.n(o),c=i("ERkP"),h=i("rxPX"),p=i("0KEI"),d=i("6rlp"),u=i("H9MA"),_=i("RqPI"),y=i("yr4d"),m=i("XOJV"),b=i("eXeu");const v=()=>(e,t,{api:i})=>i.getHttpClient(),P=(e,t)=>{const i=t.source&&t.source.videoId;return i&&"tweet"===i.type?i.id:void 0};var g=Object(h.a)().propsFromState(()=>({dataSaverMode:u.c,language:_.f,sourceTweet:m.a.createHydratedTweetSelector(P)})).adjustStateProps(({dataSaverMode:e,language:t,sourceTweet:i})=>({dataSaverMode:e,language:t,mediaAvailability:i&&Object(b.b)(i)||void 0,publisherId:i?Object(b.c)(i):void 0})).propsFromActions(()=>({createLocalApiErrorHandler:Object(p.d)("INLINE_PLAYER_CONTAINER"),getTwitterAuthedHttpClient:v,logPromotedVideoEvent:d.b,tweetAdProvider:y.b})).withAnalytics(),I=i("wrlS"),f=i("aWzz"),C=i("6v1f"),w=i("ZeN/"),A=i("rHpw"),E=i("MWbm");const T=e=>{e.preventDefault(),e.stopPropagation()};var O=({children:e,testID:t})=>c.createElement(E.a,{onClick:T,style:A.a.absoluteFill,testID:t},e),R=i("epkG"),S=i("3XMw"),H=i.n(S),M=i("mN6z"),L=i("/NU0"),k=(i("u+Xj"),i("ylrv"));class F{constructor(e,t,i){this.placement=e,this.obstructions=t,this.layerId=i}getPositionData(){return{percentVisible:this.visibleFraction(),percentOfViewportOccupied:this.placement.viewportOccupiedFraction(),sizesInfo:{viewportSize:this.placement.viewport,mediaSize:this.placement.item}}}visibleFraction(){const e=this.placement.visiblePart();if(!e)return 0;const t=Object(L.a)(this.layerId)?this.obstructions.getObstructionAboveLayer(this.layerId,e):this.obstructions.getTotalObstruction(e),i=k.a.area(this.placement.item),s=(1-t)*k.a.area(e);return i>0?s/i:0}top(){return this.placement.item.top}distanceToCenter(){return this.placement.verticalDistanceToViewportCenter()}distanceToTop(){return this.placement.verticalDistanceToViewportTop()}scrollY(){return this.placement.scrollY}}var D=i("7nmT"),N=i.n(D),x=i("zHh/"),j="videoPlayer",U=i("aITJ"),V=i("Xq8B"),q=i("Zl35"),z=i("9Xij"),W=i("iOGT"),B=i("mf9H"),X=(i("kYxP"),i("gZV8")),G=i("vF3p"),J=i("S4UJ");class Y extends c.Component{constructor(...e){super(...e),l()(this,"_handleIntersectionChange",()=>{const{onChange:e}=this.props;this.sample(e)}),l()(this,"_handlePlacementChange",e=>{this._updateAndNotify({placement:e},this.props.onChange)}),l()(this,"_handleObstructionChange",()=>{const{obstructionDetection:e,onChange:t}=this.props;this._updateAndNotify({obstructions:e.getObstructions()},t)}),l()(this,"_setPlacementRef",e=>{const{setAPI:t}=this.props;if(this._placementRef=e,window.IntersectionObserver){const e=N.a.findDOMNode(this._placementRef);if(this._element=e&&e instanceof window.HTMLElement?e:void 0,this._element){const e={threshold:[0,B.a,.5,1]};this._intersectionObserver=new window.IntersectionObserver(this._handleIntersectionChange,e),this._intersectionObserver.observe(this._element)}}t(this._placementRef?{sample:e=>this.sample(e)}:void 0)})}sample(e){this._placementRef&&this._placementRef.sample(t=>{this._updateAndNotify({placement:t},e)})}render(){const{children:e,style:t}=this.props;return c.createElement(X.a,{onPlacementChange:this._handlePlacementChange,ref:this._setPlacementRef,style:t},e)}componentDidMount(){const{obstructionDetection:e}=this.props;this._obstructionSubscription=e.subscribe(this._handleObstructionChange)}componentWillUnmount(){this._obstructionSubscription&&(this._obstructionSubscription.unsubscribe(),this._obstructionSubscription=void 0),this._intersectionObserver&&this._intersectionObserver.disconnect()}_updateAndNotify({placement:e,obstructions:t},i){const{layerId:s,obstructionDetection:n}=this.props;this._placement=e||this._placement,this._obstructions=t||this._obstructions||n.getObstructions(),this._placement?i(new F(this._placement,this._obstructions,s)):this._placementRef&&this._placementRef.sample(e=>{this._placement=e,this._obstructions=this._obstructions||n.getObstructions(),i(new F(e,this._obstructions,s))})}}l()(Y,"defaultProps",{obstructionDetection:G.a});var Z=Object(J.a)(Y);const K=H.a.d58baa7e,Q=new R.a({});class $ extends c.Component{constructor(e,t){super(e,t),l()(this,"_videoRef",c.createRef()),l()(this,"_emitter",null),l()(this,"_playerInternal",null),l()(this,"_placementRef",null),l()(this,"_isLooping",!1),l()(this,"_renderLegacyPlayer",e=>{const{accessibilityLabel:t,analytics:i,source:{contentId:s,eventId:a,videoId:r,vmapUrl:o},cta:l,displayOptions:h,durationMs:p,intentToPlayTime:d,videoEl:u,viewCount:_,includeBroadcastEventAssociation:y,showControls:m,geolocationPrompt:b,timecode:v,mediaAvailability:P,noAuthHttpClient:g,publisherId:I,twitterAuthedHttpClient:f,language:C,maxLoopCount:w,videoPlayer:A}=this.props,E=h;return c.createElement(A,n()({accessibilityLabel:t,adProvider:this._tweetAdProvider(),analytics:i,contentId:s,controls:m,cta:l,customOverlay:this._deriveCustomOverlay(),disableHls:this._disableHls,displayOptions:E,durationMs:p,enableNativeFullscreen:this._enableNativeFullscreen,eventId:a,geolocationPrompt:b,httpClient:g,includeBroadcastEventAssociation:y,initiallyMutedCaptions:!0,intentToPlayTime:d,language:C,maxLoopCount:w,mediaAvailability:P,playbackSessionId:r.id,precache:this._precacheEnabled,publisherId:I,ref:m?void 0:this._videoRef,requestedTimecode:v,setPlayerApi:this._setPlayerApi,shortNumberFormatter:K,twitterAuthedHttpClient:f,videoEl:u,videoId:r,viewCount:_,vmapUrl:o},e))}),l()(this,"_renderHorizonPlayer",e=>{const{accessibilityLabel:t,analytics:i,source:{contentId:s,eventId:a,videoId:r,vmapUrl:o},cta:l,displayOptions:h,durationMs:p,intentToPlayTime:d,videoEl:u,viewCount:_,includeBroadcastEventAssociation:y,showControls:m,geolocationPrompt:b,timecode:v,mediaAvailability:P,noAuthHttpClient:g,publisherId:I,twitterAuthedHttpClient:f,language:C,maxLoopCount:w,videoPlayer:A,uiStack:E}=this.props;return c.createElement(q.b,n()({accessibilityLabel:t,adProvider:this._tweetAdProvider(),analytics:i,basePlayerClass:A,contentId:s,cta:l,disableHls:this._disableHls,durationMs:p,enableNativeFullscreen:this._enableNativeFullscreen,eventId:a,geolocationPrompt:b,httpClient:g,includeBroadcastEventAssociation:y,initiallyMutedCaptions:!0,intentToPlayTime:d,language:C,maxLoopCount:w,mediaAvailability:P,objectFitVideo:h&&h.objectFitVideo,onApiReady:this._handleApiReady,playbackSessionId:r.id,precache:this._precacheEnabled,publisherId:I,ref:m?void 0:this._videoRef,requestedTimecode:v,twitterAuthedHttpClient:f,videoEl:u,videoId:r,viewCount:_,vmapUrl:o},e),E)}),l()(this,"_setPlayerApi",e=>{const{onMuteChange:t,customOverlay:i}=this.props;"function"==typeof i&&(this._playerInternal=e,this.forceUpdate()),t&&(e.on("unmute",()=>t({isPlayerMuted:!1})),e.on("mute",()=>t({isPlayerMuted:!0}))),e&&(e.on("fullscreenEntered",()=>this._handleFullscreenChange({isPlayerFullscreen:!0})),e.on("fullscreenExited",()=>this._handleFullscreenChange({isPlayerFullscreen:!1}))),this._setPlayerInternal(e)}),l()(this,"_handleApiReady",this._setPlayerApi),l()(this,"_deriveCustomOverlay",()=>{const{customOverlay:e}=this.props;return"function"==typeof e?this._playerInternal?e(this._playerInternal,this._containerRef):null:e}),l()(this,"_getLoopingThreshold",()=>{const{loopingThresholdMs:e,source:{videoId:t}}=this.props;return e||"tweet"===t.type&&6e4||7e3}),l()(this,"_handleAutoPlayRequest",()=>{const{onAutoplay:e}=this.props;this._playerInternal&&(this._playerInternal.playPreview(),e&&e())}),l()(this,"_handlePauseRequest",()=>{const{onAutopause:e}=this.props;this._playerInternal&&(this._playerInternal.pause(),e&&e())}),l()(this,"_handlePlacementChange",e=>{this._emitter&&this._emitter.signalPlacementChange(e),this._playerInternal&&this._playerInternal.updatePosition(e.getPositionData())}),l()(this,"_handlePlaybackComplete",()=>{this._emitter&&this._emitter.signalPlaybackFinish()}),l()(this,"_handlePlaybackStarted",()=>{this._emitter&&this._emitter.signalPlay(),this.props.onPlaybackStarted&&this.props.onPlaybackStarted()}),l()(this,"_handlePlaybackPaused",()=>{this._emitter&&this._emitter.signalPause()}),l()(this,"_handlePlayerState",e=>{const{onPlayerState:t,onProgressChange:i}=this.props;t&&t(e);const s=(e.tracks||[]).find(t=>t.id===e.currentTrackId);if(s){const t=(s.currentTimeMs||0)/s.durationMs;i&&i(t,e.tracksFinished)}}),l()(this,"_handleError",e=>{const{onError:t}=this.props,{error:i}=e;i?(this._emitter&&(this._emitter.unregister(),this._emitter=void 0,this._hasInitialPlacementMeasurement=!1,this._lastPlayerError=i),e.errorInfo&&!e.errorInfo.canRetry&&(t&&t(),this._onErrorUnsubscribe&&this._onErrorUnsubscribe())):!this._emitter&&this._lastPlayerError&&(this._registerPlaybackCoordination(),this._submitInitialPlacement(),this._lastPlayerError=void 0)}),l()(this,"_handleFullscreenChange",e=>{const t=this.context.viewport;if(t&&(t.temporarilySuppressScrollListeners(2e3),U.a.isChrome()||U.a.isSafari()))if(e.isPlayerFullscreen)this._savedScrollPosition={y:t.scrollY(),x:t.scrollX()};else if(this._savedScrollPosition){const{x:e,y:i}=this._savedScrollPosition;this._savedScrollPosition=void 0,t.scrollTo(e,i)}const{onFullscreenChange:i}=this.props;i&&i(e)}),l()(this,"_registerPlaybackCoordination",()=>{const{autoplay:e,forwardPivotInfo:t,playbackCoordination:i}=this.props,s={onAutoPlayRequest:this._handleAutoPlayRequest,onPauseRequest:this._handlePauseRequest,canAutoplay:Object(x.a)(e,t),isLooping:this._isLooping};i&&(this._emitter=i.register(s))}),l()(this,"_setPlayerInternal",e=>{if(this._playerInternal=e,e){const{onPlayerState:t,onProgressChange:i}=this.props;(t||i)&&e.subscribe(this._handlePlayerState),this._onErrorUnsubscribe=e.subscribe(this._handleError),e.on("playbackComplete",this._handlePlaybackComplete),e.on("play",this._handlePlaybackStarted),e.on("pause",this._handlePlaybackPaused),this._registerPlaybackCoordination(),this._submitInitialPlacement()}if(this.props.setPlayer){const e=this._playerInternal&&{play:()=>{this._playerInternal&&this._playerInternal.play()},pause:()=>{this._playerInternal&&this._playerInternal.pause()},replay:()=>{this._playerInternal&&this._playerInternal.replay()}};this.props.setPlayer(e)}}),l()(this,"_setPlacementAPI",e=>{this._placementRef=e,this._submitInitialPlacement()}),l()(this,"_getTweetId",()=>{const{source:{videoId:e}}=this.props;if(e){if("tweet"===e.type)return e.id;if("broadcast"===e.type)return e.tweetId}}),l()(this,"_tweetAdProvider",()=>{const e=this._getTweetId();if(e)return()=>this.props.tweetAdProvider(e)}),this._enableNativeFullscreen=I.a.isTrue("responsive_web_video_native_fullscreen_enabled"),this._disableHls=!(U.a.isDesktopOS()||U.a.isAndroid()&&I.a.isTrue("web_video_hls_android_mse_enabled")),this._precacheEnabled=!U.a.isMobileOS()&&I.a.hasValue("responsive_web_video_precaching_8507","precaching")}componentDidMount(){if(!this._containerRef&&this._videoRef.current){const e=N.a.findDOMNode(this._videoRef.current);e instanceof HTMLElement&&(this._containerRef=e)}}componentDidUpdate(e){const{heightsReady:t}=this.props;!e.heightsReady&&t&&this._submitInitialPlacement()}render(){const{aspectRatio:e}=this.props;return c.createElement(z.a,{ratio:e,style:ee.aspectRatio},c.createElement(Z,{onChange:this._handlePlacementChange,setAPI:this._setPlacementAPI,style:A.a.absoluteFill},this._renderPlayer()))}UNSAFE_componentWillReceiveProps(e){Object(M.a)(this.props.source,e.source)||this._emitter&&this._emitter.reset()}componentWillUnmount(){this._emitter&&(this._emitter.unregister(),this._emitter=null),this._onErrorUnsubscribe&&this._onErrorUnsubscribe()}_renderPlayer(){const{source:{variants:e},durationMs:t,forceLoop:i,videoType:s,poster:n,promotedContent:a,dataSaverMode:r}=this.props,o="animated_gif"===s,l="vine"===s,h=e&&e.length?o?"gif":"media_entity":"vmap";this._isLooping=!!(i||o||l||t&&t<=this._getLoopingThreshold());const p={bitrateCap:r?w.a.MEDIUM:void 0,contentType:h,featureProvider:I.a,loop:this._isLooping,poster:n&&n.url,promotedContext:a&&(a.impression_id||a.disclosure_type)?{impressionId:a.impression_id,disclosureType:a.disclosure_type}:void 0,variants:e&&Object(b.e)(Object(W.c)(e,r?W.a.MEDIUM:W.a.HIGH).map(e=>({src:e.url,type:e.content_type})))};return c.createElement(O,{testID:j},Object(b.d)(this.props)?this._renderHorizonPlayer(p):this._renderLegacyPlayer(p))}_submitInitialPlacement(){const{heightsReady:e}=this.props,t=e&&!this._hasInitialPlacementMeasurement;this._emitter&&this._placementRef&&t&&(this._placementRef.sample(this._handlePlacementChange),this._hasInitialPlacementMeasurement=!0)}}l()($,"contextTypes",{viewport:f.object}),l()($,"defaultProps",{autoplay:C.b.Off,playbackCoordination:B.c,showControls:!0,dataSaverMode:!1,geolocationPrompt:!0,heightsReady:!0,noAuthHttpClient:Q,includeBroadcastEventAssociation:!1});const ee=A.a.create({aspectRatio:{zIndex:void 0}});var te=i("fs1G"),ie=i("64vW");class se extends c.PureComponent{constructor(e){super(e),l()(this,"_player",null),l()(this,"_getBaseItem",e=>{const{analytics:t,includeBroadcastEventAssociation:i,source:{videoId:s}}=this.props,{event_id:n}=t.contextualScribeData;let a;return a="broadcast"===s.type&&s.tweetId?s.tweetId:"broadcast"===s.type&&i&&n?n:s.id,e.find(e=>e.id===a)}),l()(this,"_createAnalytics",e=>{const t={log:this._scribeAction},{analytics:i}=this.props,s={log:I.a.isTrue("responsive_web_video_promoted_logging_enabled")?this._logPromotedVideoEvent:te.a},n=i.contextualScribeNamespace,a=i.contextualScribeData,r=Array.isArray(a.items)?this._getBaseItem(a.items):void 0,o={scribeContext:Object.assign({},n),baseScribeItem:r,enableShortFormCompleteLogging:I.a.isTrue("responsive_web_video_pcomplete_enabled")};return new V.a(t,s,e,o)}),l()(this,"_logPromotedVideoEvent",e=>{const{createLocalApiErrorHandler:t}=this.props;this.props.logPromotedVideoEvent(e).catch(t())}),l()(this,"_scribeAction",e=>{const{category:t,data:i,namespace:s}=e,{analytics:n}=this.props;(null==s?void 0:s.action)&&n.scribe(Object.assign({},s,{data:Object.assign({},i,{_category_:t})}))}),l()(this,"_setPlayer",e=>{if(this._player=e,this.props.setPlayer){const e=this._player&&{play:()=>{this._player&&this._player.play()},pause:()=>{this._player&&this._player.pause()},replay:()=>{this._player&&this._player.replay()}};this.props.setPlayer(e)}}),this._twitterAuthedHttpClient=e.getTwitterAuthedHttpClient(),this._analytics=this._createAnalytics(this._twitterAuthedHttpClient)}render(){const e=this.props,{tweetAdProvider:t}=e,i=r()(e,["createLocalApiErrorHandler","getTwitterAuthedHttpClient","tweetAdProvider"]),{heightsReady:s}=this.context;return c.createElement($,n()({},i,{analytics:this._analytics,heightsReady:s,setPlayer:this._setPlayer,tweetAdProvider:t,twitterAuthedHttpClient:this._twitterAuthedHttpClient}))}}l()(se,"contextType",ie.a);const ne=g(se);t.default=ne},"ZeN/":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return r}));const s={LOW:32e4,MEDIUM:832e3,HIGH:2176e3},n={EVENT:"event",VISIT:"url",WATCH:"watch",IMAGE:"image",WATCH_NOW:"watch_now",SHOP:"shop"},a=3,r=["cover","contain"]}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/ondemand.InlinePlayer.159ac1d5.js.map