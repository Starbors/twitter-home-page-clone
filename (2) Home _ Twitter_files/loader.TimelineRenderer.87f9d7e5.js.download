(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{"3GUV":function(e,t,s){"use strict";var n=s("ERkP"),i=s("rHpw"),r=s("MWbm");class o extends n.Component{shouldComponentUpdate(){return!1}render(){return n.createElement(r.a,{style:a.root})}}const a=i.a.create(e=>({root:{height:5*parseInt(e.lineHeight,10)+"rem"}}));t.a=o},"5UID":function(e,t,s){"use strict";var n=s("ERkP"),i=s("3XMw"),r=s.n(i),o=s("rHpw"),a=(s("aWzz"),s("+/1j")),c=s("MWbm");const l=r.a.e5b0063d;let h=0;class d extends n.Component{constructor(){super(),this._listDomId="accessible-list-"+h,h+=1}render(){const{children:e,title:t}=this.props,s=l({title:t});return n.createElement(c.a,{accessibilityRole:"region","aria-labelledby":this._listDomId},n.createElement(a.a,{accessibilityRole:"heading","aria-level":1,nativeID:this._listDomId,style:o.a.visuallyHidden},t),n.createElement(c.a,{accessibilityLabel:s},e))}}t.a=d},JsJV:function(e,t,s){"use strict";var n=s("6/RC"),i=s("tI3i"),r=s.n(i),o=n.canUseDOM?window.location.href:"",a={addEventListener:function(){},removeEventListener:function(){},canOpenURL:function(){return Promise.resolve(!0)},getInitialURL:function(){return Promise.resolve(o)},openURL:function(e){try{return c(e),Promise.resolve()}catch(e){return Promise.reject(e)}},_validateURL:function(e){r()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),r()(e,"Invalid URL: cannot be empty")}},c=function(e){n.canUseDOM&&(window.location=new URL(e,window.location).toString())};t.a=a},ainm:function(e,t,s){"use strict";s.r(t),s.d(t,"TimelineRenderer",(function(){return le}));s("IAdD"),s("kYxP");var n=s("KEM+"),i=s.n(n),r=s("n+Zb"),o=s("ERkP"),a=s("7nmT"),c=s.n(a),l=s("nfVA"),h=s("EhiH"),d=s("zrc3");const p=(e,t)=>{const s=Object(h.a)(e,e=>t.has(e.entryId));return s?s.entryId:void 0};var m=s("5UID"),u=s("1YZw"),_=s("rxPX"),y=Object(_.a)().propsFromActions(()=>({addToast:u.b})).withAnalytics(),b=s("KNCp"),g=s("lUZE");var f=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),v=s("caTy"),I=s("TnY3"),C=s("TIdA"),E=s("A91F"),w=s("feu+"),T=s("JsJV"),R=s("MWbm"),x=s("oQhu"),S=s("fs1G"),A=s("rcen");class L extends o.PureComponent{constructor(...e){super(...e),i()(this,"_getGraphicProps",Object(x.a)((e,t)=>{const s=e?({style:t})=>o.createElement(R.a,{style:t},o.createElement(C.a,{accessibilityLabel:"",aspectMode:E.a.exact(e.width/e.height),image:e})):g.a;let n="illustration";return e&&t!==f.IconSmall?t===f.FullWidth&&(n="illustrationFullWidth"):n="icon",{graphic:s,graphicDisplayMode:n}})),i()(this,"_scribeAction",(e,t)=>{const{analytics:s}=this.props,{action:n,component:i,element:r}=t||{};s.scribe({action:n||e,component:i||"cover",element:r})}),i()(this,"_handleDismiss",()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:s,clientEventInfo:n}=e||{};s&&s.forEach(e=>{t(e)}),e&&(this._scribeAction("dismiss",n),this.props.onClose())}),i()(this,"_handlePrimaryCtaClick",()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")}),i()(this,"_handleSecondaryCtaClick",()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")}),i()(this,"_handleCtaClick",({ctaBehavior:e,callbacks:t,clientEventInfo:s},n)=>{const{addToast:i,processCallback:r,history:o}=this.props;if(this.props.onClose(),this._scribeAction("click",Object.assign({element:n},s)),e.dismiss){const{dismiss:t}=e;t&&t.feedbackMessage&&i({text:t.feedbackMessage.text})}if(e.navigate){const{navigate:t}=e,s=t&&Object(v.b)(t.url);s&&(s.external?T.a.openURL(s.pathname):o.push(s.pathname))}t&&t.forEach(e=>r(e))})}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{image:e,imageDisplayType:t,primaryText:s,primaryCta:n,secondaryText:i,secondaryCta:r,details:a,displayType:c,type:l,dismissInfo:h}=this.props,d=o.createElement(A.b,{entities:s.entities,text:s.text}),p=i?o.createElement(A.b,{entities:i.entities,text:i.text}):null;if(l===b.a.Full){const l=a?o.createElement(A.b,{entities:a.entities,text:a.text}):null,{graphic:m,graphicDisplayMode:u}=this._getGraphicProps(e,t);return o.createElement(w.a,{actionLabel:n.text,footer:l,footerAlign:a&&a.alignment===A.a.Center?"center":"left",graphic:m,graphicDisplayMode:u,headline:d,headlineAlign:s.alignment===A.a.Natural?"left":"center",isFullHeightOnMobile:!h&&"CenterCover"!==c,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:p,subtextAlign:i&&i.alignment===A.a.Natural?"left":"center",tertiaryActionLabel:r&&r.text,withCloseButton:!!h})}return o.createElement(w.a,{actionLabel:n.text,graphicDisplayMode:"none",headline:d,headlineAlign:s.alignment===A.a.Center?"center":"left",onAction:this._handlePrimaryCtaClick,onClose:S.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:r&&r.text,subtext:p,subtextAlign:i&&i.alignment===A.a.Center?"center":"left",withCloseButton:!1})}}i()(L,"defaultProps",{imageDisplayType:f.Icon});var O=Object(I.a)(y(L)),D=s("3GUV"),j=s("8UdT"),k=s("wrlS"),N=s("MDbM"),P=s("v//M"),M=(s("C1yv"),s("Qyxo"));class U{constructor(){this._lingerScribed={},this._appearance={}}processPositioningUpdate(e,t,s=Date.now()){const n=F(e,t);return this._lingerTransition(n,s)}flushLingerEvents(e=Date.now()){return this._detectScribeLingerEvents(this._appearance,{},e)}_lingerTransition(e,t){const s=this._appearance;return this._appearance=e.reduce((e,n)=>(e[n]=s[n]||{start:t,lingered:!1},e),{}),{allLingerEvents:this._detectAllLingerEvents(s,t),scribeLingerEvents:this._detectScribeLingerEvents(s,this._appearance,t)}}_detectAllLingerEvents(e,t){return Object.keys(e).reduce((s,n)=>{const{start:i,lingered:r}=e[n];return!r&&t-i>=500&&(s.push(n),this._appearance[n]&&(this._appearance[n]=Object.assign({},this._appearance[n],{lingered:!0}))),s},[])}_detectScribeLingerEvents(e,t,s){return Object.keys(e).reduce((n,i)=>{const{start:r}=e[i];return!t[i]&&!this._lingerScribed[i]&&s-r>=500&&(this._lingerScribed[i]=!0,n.push({id:i,start:r,end:s})),n},[])}}const F=(e,t)=>Object(M.a)(e,({id:e,rectangle:s})=>B(s,t)>=.5*s.getHeight()?e:void 0),B=(e,t)=>Math.max(0,Math.min(e.getBottom(),t.getBottom())-Math.max(e.getTop(),t.getTop()));var H=s("OrGc"),W=s("hACr"),G=s("xjVt"),V=s("EUHl"),K=s("aWzz"),z=s("IG4P"),J=s("iBK2");s("rxtR");const q=Object.freeze({ON_LINGER:"onLinger"});var Z=s("aITJ"),Y=s("VPAj"),Q=s("/NU0"),X=s("iChn"),$=s("+d3d"),ee=s("I7xG"),te=s("rHpw"),se=s("cFgU");const ne=e=>e.entryId,ie=e=>e.sortIndex;const re=Object(Y.a)(o.createElement(D.a,null)),oe=new Map,ae=()=>{const e=Z.a.isDesktopOS()?k.a.getValue("responsive_web_vs_config_desktop_assumed_item_height"):void 0;return Object(Q.a)(e)?e:void 0};let ce;class le extends o.PureComponent{constructor(e){super(e),i()(this,"_entryRefs",new Map),i()(this,"_adjustFocusBy",e=>{this._shouldPreventKeyboardShortcuts()||this._updateFocus((t,s,n)=>{let i=t&&((e,t,s,n)=>{const i=e?Object(d.a)(s,t=>t.entryId===e):-1;if(i>=0){for(let e=i>=0?i+t:0;e>=0&&e<s.length;e+=t){const{entryId:t}=s[e];if(n.has(t))return t}}return i>=0?e:void 0})(t,e,s,this._entryRefs);if(!i&&this._scroller){const e=this._scroller.findTopmostVisibleId();i=e?((e,t,s)=>{const n=Object(d.a)(t,t=>t.entryId===e);let i;if(n>=0){const e=Object(h.a)(t,e=>s.has(e.entryId),n);i=e?e.entryId:void 0}return i||(i=p(t,s)),i})(e,s,this._entryRefs):p(s,this._entryRefs)}return i})}),i()(this,"_focusNext",()=>this._adjustFocusBy(1)),i()(this,"_focusPrevious",()=>this._adjustFocusBy(-1)),i()(this,"_handleCoverImpression",()=>{const{activeCover:e,scribeAction:t,processCallback:s,scribeNamespace:n}=this.props;if(!e)return;const{clientEventInfo:i,cover:{impressionCallbacks:r}}=e;r&&r.forEach(e=>s(e));let o=Object.assign({},n,{component:"cover",action:"impression"});i&&(o=Object.assign({},o,{component:i.component||o.component,element:i.element||o.element,action:i.action||o.action})),t(o)}),i()(this,"_handleDismissCover",()=>{this.props.clearActiveCover()}),i()(this,"_renderLoadBottom",Object(ee.a)(this,e=>e.bottomFetchStatus,e=>e.onBottomRetry,(e,t)=>o.createElement(R.a,{style:he.footer},o.createElement(P.a,{fetchStatus:e,onRequestRetry:t,render:re})))),i()(this,"_refreshControlWrapper",e=>{const{canRefresh:t,refreshControl:s,topFetchStatus:n,onRefresh:i}=this.props;return s?o.createElement(s,{canRefresh:t,isRefreshing:n===N.a.LOADING,onRefresh:i},e):e}),i()(this,"_getCellRenderer",Object(x.a)((e,t)=>{let s;const n={module:t,renderEntry:e=>s(e),entryRef:this._setEntryRef};return s=t=>{const s=e.getHandler(t);return s&&s.render?s.render(t,n):null},s})),i()(this,"_setEntryRef",(e,t)=>{this._entryRefs.set(e,t)}),i()(this,"_getInitialFocusedEntry",Object(x.a)((e,t)=>t&&e.find(t))),i()(this,"_createEntryIndex",Object(x.a)(e=>Object(X.a)(e,e=>e.entryId))),i()(this,"_handleBeforeWindowUnload",()=>{this._flushLingerScribes()}),i()(this,"isAtTop",()=>!!this._scroller&&this._scroller.scrollToTop()),i()(this,"scrollToTop",()=>{this._scroller&&(this._scroller.scrollToTop(),this._updateFocus((e,t,s)=>e?p(t,s):void 0,{block:"nearest"}))}),i()(this,"_shouldPreventKeyboardShortcuts",()=>{const{isModal:e,withKeyboardShortcuts:t}=this.props;return ce&&!e||!t}),i()(this,"_handleRefreshKeyboardShortcut",Object($.a)(()=>{this._shouldPreventKeyboardShortcuts()||this.refreshOrGoTop()},1e3)),i()(this,"_handleAtBottom",this._proximityHandler(()=>{this.props.onAtBottom&&this.props.onAtBottom()})),i()(this,"_handleNearBottom",this._proximityHandler(()=>{this.props.onNearBottom()})),i()(this,"_handleNearTop",this._proximityHandler(()=>{const{onNearTop:e}=this.props;e()})),i()(this,"_handleAtTop",this._proximityHandler(()=>{this.props.removeAlert&&this.props.removeAlert(),this.props.onAtTop&&this.props.onAtTop()})),i()(this,"_handleItemsRendered",this._proximityHandler(({viewport:e,positions:t})=>{const s=this._impressionTracker.processPositioningUpdate(t,e);this._scribeLingerEvents(s.scribeLingerEvents),this._handleOnLingerEvents(s.allLingerEvents)})),i()(this,"_handleOnLingerEvents",e=>{const{applyReactionInstructions:t}=this.props,s=this._getEntryIndex();e.forEach(e=>{const n=s[e];n&&t({entry:n,triggerName:q.ON_LINGER})})}),i()(this,"_handlePositionRestored",()=>{this._positionedRestored=!0}),i()(this,"_scribeNewEntries",function(e){const t=window.requestIdleCallback||window.requestAnimationFrame;return s=>{t(()=>{e(s)})}}(e=>{const{richScribeAction:t,scribeNamespace:s}=this.props,n=this._buildStreamScribeData(e);if(n.length>0){t(Object.assign({},s,{component:"stream",action:"results"}),{items:n})}})),i()(this,"_setScroller",e=>{this._scroller=e}),this._impressionTracker=new U}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTracker=new U)}componentDidMount(){const{isModal:e,onRef:t}=this.props;this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(this),e&&(ce=!0)}componentWillUnmount(){const{isModal:e,onRef:t}=this.props;this._flushLingerScribes(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(void 0),e&&(ce=!1)}componentDidUpdate(e){const{entries:t,handlerRegistry:s,timelineId:n,onRef:i}=this.props;n!==e.timelineId?this._initialize():t===e.entries&&s===e.handlerRegistry||this._scribeNewEntries(t),i&&i!==e.onRef&&i(this)}_updateFocus(e,t){const s=e(this._activeEntryId,this.props.entries,this._entryRefs);if(s!==this._activeEntryId){this._activeEntryId=s;const e=this._activeEntryId&&this._entryRefs.get(this._activeEntryId);e&&((e,t,s)=>{const n=c.a.findDOMNode(e),i=n&&n instanceof window.HTMLElement&&n.querySelector("a, [tabindex='0']");if(i){i.scrollIntoView(s),i.focus();const e=(t||l.a.root()).getRect().getTop();e>0&&window.scrollBy(0,-1*e)}})(e,this.context.viewport,t)}}render(){const{activeCover:e,anchoring:t,entries:s,handlerRegistry:n,showFooter:i,header:a,isInitialFocusEntry:c,nearStartProximityRatio:l,renderEmptyState:h,timelineId:d,title:p,module:u}=this.props,_=this.props.scroller,y=this._getInitialFocusedEntry(s,c);return this._refreshControlWrapper(this._shouldRenderEmptyState(s)?h():o.createElement(m.a,{title:p},e?this._renderActiveCover():null,this._renderPill(),o.createElement(W.a,{handlers:{[H.d.loadNewTweets]:this._handleRefreshKeyboardShortcut,[H.d.nextItem]:this._focusNext,[H.d.previousItem]:this._focusPrevious}},o.createElement(_,{anchoring:t,assumedItemHeight:ae(),cacheKey:d,footer:i&&this._renderLoadBottom(),header:a,identityFunction:ne,initialAnchor:y&&r.b(ne(y)),items:s,nearStartProximityRatio:l,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:this._handleItemsRendered,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,ref:this._setScroller,renderer:this._getCellRenderer(n,u),sortIndexFunction:ie}))))}_renderPill(){const{alert:e,removeAlert:t,topUnseenCount:s,newTweetsPillMode:n,scribeNamespace:i,timelineId:r}=this.props;return n?n===V.a.URT?o.createElement(G.a.Configure,{alert:e,removeAlert:t,scribeNamespace:i,timelineId:r}):n===V.a.CLIENT&&s&&s>0&&k.a.isTrue("responsive_web_tweets_pill_local_enabled")?o.createElement(G.a.Configure,{removeAlert:t,scribeNamespace:i,timelineId:r,unreadCount:s}):void 0:null}_renderActiveCover(){const{activeCover:e}=this.props,t=e&&e.cover;return e&&t?"full"===e.type?this._renderFullCover(e.cover):"half"===e.type?this._renderHalfCover(e.cover):null:null}_renderFullCover(e){const{processCallback:t}=this.props;return o.createElement(O,{details:e.details||void 0,dismissInfo:e.dismissInfo,displayType:e.displayType,image:e.image,imageDisplayType:e.imageDisplayType||void 0,onClose:this._handleDismissCover,onImpression:this._handleCoverImpression,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:t,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:"full"})}_renderHalfCover(e){const{processCallback:t}=this.props,s="CenterCover"===e.displayType?"full":"half";return o.createElement(O,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:this._handleDismissCover,onImpression:this._handleCoverImpression,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:t,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:s})}_shouldRenderEmptyState(e){const{activeCover:t,initialFetchStatus:s}=this.props,n=s===N.a.LOADED,i=0===e.length;return n&&i&&!t}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._scribeNewEntries(this.props.entries),this._activeEntryId=void 0}_flushLingerScribes(){this._scribeLingerEvents(this._impressionTracker.flushLingerEvents())}refreshOrGoTop(){this._scroller&&!this._scroller.isAtTop()?this.scrollToTop():this.props.onRefresh()}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_buildStreamScribeData(e){const{scribeCache:t,timelineId:s,handlerRegistry:n}=this.props;let i=null;if(!t.has(s)){const e=new Set;t.set(s,e)}const r=t.get(s);return r?e.reduce((e,t,s)=>{const{entryId:o}=t;let a=!1;if(t.content&&t.content.promotedMetadata&&(a=t.content.promotedMetadata),!r.has(o)&&!n.getNeedsLoad(t)){r.add(o);const s=this._getScribeDataItem(n,t);s&&(a&&null!==i&&(s.tweet_count=i),e.push(s))}return a?i=0:null!==i&&-1===t.type.indexOf("ui_")&&(i+=1),e},[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:s,timelineId:n}=this.props;"home"===n&&t?t.addNewTweets(e):"home-latest"===n&&s&&s.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,s=this._getEntryIndex(),n=[],i=[];if(e.forEach(({id:e,start:r,end:o})=>{const a=s[e];if(a){const e=this._getScribeDataItem(t,a);if(e){const t={visibility_start:r,visibility_end:o};n.push(Object.assign({},e,{impression_details:t}))}a.type===j.c.Tweet&&i.push(a.content.id)}}),n.length>0){const{richScribeAction:e,scribeNamespace:t}=this.props;e(Object.assign({},t,{component:"stream",element:"linger",action:"results"}),{items:n})}i.length>0&&this._storeSeenIds(i)}_getScribeDataItem(e,t){const s=e.getHandler(t);if(s)return s.getScribeDataItem(t)}}i()(le,"contextTypes",{viewport:K.object}),i()(le,"defaultProps",{showFooter:!0,onBottomRetry:S.a,onNearBottom:S.a,onNearTop:S.a,onRefresh:S.a,refreshControl:z.a,scribeCache:oe,scroller:J.b,seenIds:Object(se.b)(),seenIdsLatest:Object(se.a)(),withKeyboardShortcuts:!0});const he=te.a.create(e=>({footer:{height:`calc(5 * ${e.lineHeight}rem)`}}));t.default=le},"n+Zb":function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return i}));const n=e=>({id:e,distanceToViewportTop:0}),i=e=>({id:e,distanceToViewportBottom:0})}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.87f9d7e5.js.map